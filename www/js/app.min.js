"use strict";var BookingSystem=angular.module("BookingSystem",["ionic","BookingSystem.controllers","BookingSystem.furnituring","BookingSystem.furnituringServices","BookingSystem.meals","BookingSystem.mealsServices","BookingSystem.mealPropertiesServices","BookingSystem.resources","BookingSystem.resourcesServices","BookingSystem.locationBooking","BookingSystem.locationBookingServices","BookingSystem.locations","BookingSystem.locationsServices","BookingSystem.calendarDayDirective","BookingSystem.customers","BookingSystem.customersServices","BookingSystem.bookingTypes","BookingSystem.bookingTypesServices","BookingSystem.imageResizeServices","BookingSystem.calendarWeekDirective","BookingSystem.bookingHelperServices","BookingSystem.imageUploaderDirective","BookingSystem.locationsServices","BookingSystem.ngMinMaxDirectives","BookingSystem.filters","BookingSystem.bookingServices","BookingSystem.resourceBooking","BookingSystem.resourceBookingServices","BookingSystem.calendarDaysHeaderDirective","BookingSystem.start","BookingSystem.mealBookingServices","BookingSystem.mealBooking","BookingSystem.bookings","ngMaterial","ngResource","ngMessages"]);BookingSystem.run(["$ionicPlatform",function(o){o.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar&&StatusBar.styleDefault()}),moment.locale("sv")}]),BookingSystem.constant("API_URL","http://localhost:6796/api/"),BookingSystem.constant("API_IMG_PATH_URL","http://bokning.vvfors.se/"),BookingSystem.constant("UPLOAD_IMG_MAX_WIDTH","300"),BookingSystem.constant("UPLOAD_IMG_MAX_HEIGHT","300"),BookingSystem.constant("PHOTO_MISSING_SRC","img/photo_missing.svg"),BookingSystem.constant("DEFAULT_MAP_ZOOM",5),BookingSystem.constant("DEFAULT_LATITUDE",59.2792),BookingSystem.constant("DEFAULT_LONGITUDE",15.2361),BookingSystem.constant("MODAL_ANIMATION","slide-in-up"),BookingSystem.constant("DATA_SYNC_INTERVAL_TIME",3e5),BookingSystem.constant("DEFAULT_CALENDAR_ZOOM",2),BookingSystem.constant("BOOKING_TYPES",{booking:"booking",location:"location-booking",resource:"resource-booking",meal:"meal-booking"}),BookingSystem.config(["$stateProvider","$urlRouterProvider","$mdDateLocaleProvider",function(o,e,t){o.state("app",{url:"/app","abstract":!0,templateUrl:"templates/menu.html",controller:"AppCtrl"}).state("app.start",{url:"/start",params:{bookingType:"booking"},views:{menuContent:{templateUrl:"templates/booking/booking-view.html",controller:"BookingViewCtrl"}}}).state("app.booking-details",{url:"/booking-details",params:{id:null},views:{menuContent:{templateUrl:"templates/booking/booking-details.html",controller:"BookingDetailsCtrl"}}}).state("app.booking-view",{url:"/start",params:{bookingType:"booking"},views:{menuContent:{templateUrl:"templates/booking/booking-view.html",controller:"BookingViewCtrl"}}}).state("app.meal-booking-view",{url:"/meal-booking-view",views:{menuContent:{templateUrl:"templates/meal-booking/meal-booking-view.html",controller:"MealBookingViewCtrl"}}}).state("app.meal-booking-details",{url:"/meal-booking-details",params:{id:null},views:{menuContent:{templateUrl:"templates/meal-booking/meal-booking-details.html",controller:"MealBookingDetailsCtrl"}}}).state("app.meal-booking-create",{url:"/meal-booking-create",params:{date:null,bookingId:null,customerId:null},views:{menuContent:{templateUrl:"templates/meal-booking/meal-booking-create.html",controller:"MealBookingCreateCtrl"}}}).state("app.resource-booking-view",{url:"/resource-booking-view",views:{menuContent:{templateUrl:"templates/resource-booking/resource-booking-view.html",controller:"ResourceBookingViewCtrl"}}}).state("app.resource-booking-details",{url:"/resource-booking-details",params:{id:null},views:{menuContent:{templateUrl:"templates/resource-booking/resource-booking-details.html",controller:"ResourceBookingDetailsCtrl"}}}).state("app.resource-booking-create",{url:"/resource-booking-create",params:{date:null,bookingId:null,customerId:null},views:{menuContent:{templateUrl:"templates/resource-booking/resource-booking-create.html",controller:"ResourceBookingCreateCtrl"}}}).state("app.location-booking-view",{url:"/location-booking-view",views:{menuContent:{templateUrl:"templates/location-booking/location-booking-view.html",controller:"LocationBookingViewCtrl"}}}).state("app.location-booking-details",{url:"/location-booking-details",params:{id:null},views:{menuContent:{templateUrl:"templates/location-booking/location-booking-details.html",controller:"LocationBookingDetailsCtrl"}}}).state("app.location-booking-create",{url:"/location-booking-create",params:{date:null,bookingId:null,customerId:null},views:{menuContent:{templateUrl:"templates/location-booking/location-booking-create.html",controller:"LocationBookingCreateCtrl"}}}).state("app.furnituring-list",{url:"/furnituring-list",views:{menuContent:{templateUrl:"templates/furnituring/furnituring-list.html",controller:"FurnituringListCtrl"}}}).state("app.furnituring-details",{url:"/furnituring-details/:furnituringId",views:{menuContent:{templateUrl:"templates/furnituring/furnituring-details.html",controller:"FurnituringDetailsCtrl"}}}).state("app.furnituring-create",{url:"/furnituring-create",views:{menuContent:{templateUrl:"templates/furnituring/furnituring-create.html",controller:"FurnituringCreateCtrl"}}}).state("app.meals-list",{url:"/meals-list",views:{menuContent:{templateUrl:"templates/meals/meals-list.html",controller:"MealsListCtrl"}}}).state("app.meal-details",{url:"/meal-details/:mealId",views:{menuContent:{templateUrl:"templates/meals/meal-details.html",controller:"MealDetailsCtrl"}}}).state("app.meal-create",{url:"/meal-create",views:{menuContent:{templateUrl:"templates/meals/meal-create.html",controller:"MealCreateCtrl"}}}).state("app.resources-list",{url:"/resources-list",views:{menuContent:{templateUrl:"templates/resources/resources-list.html",controller:"ResourcesListCtrl"}}}).state("app.resource-details",{url:"/resource-details/:resourceId",views:{menuContent:{templateUrl:"templates/resources/resource-details.html",controller:"ResourceDetailsCtrl"}}}).state("app.resource-create",{url:"/resource-create",views:{menuContent:{templateUrl:"templates/resources/resource-create.html",controller:"ResourceCreateCtrl"}}}).state("app.customers-list",{url:"/customers-list",views:{menuContent:{templateUrl:"templates/customers/customers-list.html",controller:"CustomersListCtrl"}}}).state("app.customer-details",{url:"/customer-details/:customerId",views:{menuContent:{templateUrl:"templates/customers/customer-details.html",controller:"CustomerDetailsCtrl"}}}).state("app.customer-create",{url:"/customer-create",views:{menuContent:{templateUrl:"templates/customers/customer-create.html",controller:"CustomerCreateCtrl"}}}).state("app.bookingtypes-list",{url:"/bookingtypes-list",views:{menuContent:{templateUrl:"templates/bookingtypes/bookingtypes-list.html",controller:"BookingTypesListCtrl"}}}).state("app.bookingtype-details",{url:"/bookingtype-details/:bookingTypeId",views:{menuContent:{templateUrl:"templates/bookingtypes/bookingtype-details.html",controller:"BookingTypeDetailsCtrl"}}}).state("app.bookingtype-create",{url:"/bookingtype-create",views:{menuContent:{templateUrl:"templates/bookingtypes/bookingtype-create.html",controller:"BookingTypeCreateCtrl"}}}).state("app.locations-list",{url:"/locations-list",views:{menuContent:{templateUrl:"templates/locations/locations-list.html",controller:"LocationsListCtrl"}}}).state("app.location-details",{url:"/location-details/:locationId",views:{menuContent:{templateUrl:"templates/locations/location-details.html",controller:"LocationDetailsCtrl"}}}).state("app.location-create",{url:"/location-create",views:{menuContent:{templateUrl:"templates/locations/location-create.html",controller:"LocationCreateCtrl"}}}),e.otherwise("/app/start")}]),BookingSystem.config(["$mdDateLocaleProvider",function(o){o.months=["Januari","Februari","Mars","April","Maj","Juni","Juli","Augusti","September","Oktober","November","December"],o.shortMonths=["jan","feb","mar","apr","maj","jun","jul","aug","sep","okt","nov","dec"],o.days=["söndag","måndag","tisdag","onsdag","torsdag","fredag","lördag"],o.shortDays=["Sö","Må","Ti","On","To","Fr","Lö"],o.firstDayOfWeek=1,o.parseDate=function(o){var e=moment(o,"L",!0);return e.isValid()?e.toDate():new Date(NaN)},o.formatDate=function(o){return moment(o).format("L")},o.monthHeaderFormatter=function(e){return o.shortMonths[e.getMonth()]+" "+e.getFullYear()},o.weekNumberFormatter=function(o){return"Vecka "+o},o.msgCalendar="Kalender",o.msgOpenCalendar="Öppna kalender"}]),BookingSystem.controller("NavigationCtrl",["$scope","$state",function(o,e){}]),BookingSystem.config(["$mdGestureProvider",function(o){o.skipClickHijack()}]),angular.module("BookingSystem.furnituringServices",["ngResource"]).factory("Furnituring",["$resource","API_URL",function(o,e){return o(e+"Furnituring/:furnituringId",{furnituringId:"@furnituringId"})}]).factory("LocationFurnituring",["$resource","API_URL",function(o,e){return o(e+"LocationFurnituring/:locationId",{locationId:"@locationId"},{remove:{url:e+"LocationFurnituring/:locationId/:furnituringId",id:"@id",method:"DELETE",isArray:!1,params:{locationId:"@locationId",furnituringId:"@furnituringId"}},removeForLocation:{url:e+"LocationFurnituring/:locationId",id:"@id",method:"DELETE",isArray:!1,params:{locationId:"@locationId"}},queryForLocation:{url:e+"LocationFurnituring/location/:locationId",id:"@id",method:"GET",isArray:!0,params:{locationId:"@locationId"}},saveForLocation:{url:e+"LocationFurnituring/location",id:"@id",method:"POST",isArray:!0}})}]),angular.module("BookingSystem.controllers",[]).controller("AppCtrl",["$scope","$ionicModal","$timeout",function(o,e,t){o.loginData={},e.fromTemplateUrl("templates/login.html",{scope:o}).then(function(e){o.modal=e}),o.closeLogin=function(){o.modal.hide()},o.login=function(){o.modal.show()},o.doLogin=function(){t(function(){o.closeLogin()},1e3)}}]).controller("PlaylistsCtrl",["$scope",function(o){o.playlists=[{title:"Reggae",id:1},{title:"Chill",id:2},{title:"Dubstep",id:3},{title:"Indie",id:4},{title:"Rap",id:5},{title:"Cowbell",id:6}]}]).controller("PlaylistCtrl",["$scope","$stateParams",function(o,e){}]),angular.module("BookingSystem.furnituring",[]).controller("FurnituringListCtrl",["$rootScope","$scope","$state","Furnituring","$mdToast",function(o,e,t,n,i){var r=function(){var o=n.query();o.$promise["catch"](function(){i.show(i.simple().content("Möbleringar kunde inte hämtas, var god försök igen.").position("top right"))}),e.furniturings=o};e.$on("$ionicView.enter",function(o,e){r()})}]).controller("FurnituringDetailsCtrl",["$rootScope","$scope","$stateParams","MODAL_ANIMATION","$state","$ionicModal","Furnituring","$mdToast",function(o,e,t,n,i,r,a,s){var u="templates/modals/furnituring-delete.html";e.editMode=!1,e.furnituringBackup={};var c=function(){r.fromTemplateUrl(u,{scope:e,animation:n}).then(function(o){e.modal=o}),e.$on("$destroy",function(){e.modal.remove()})},l=function(){var o=a.get({furnituringId:t.furnituringId});o.$promise["catch"](function(){s.show(s.simple().content("Möblering kunde inte hämtas, var god försök igen.").position("top right"))}),e.furnituring=o};e.startEditMode=function(){var o=this;o.isEditMode=!0,o.furnituringBackup=angular.copy(o.furnituring)},e.endEditMode=function(){var o=this;o.isEditMode=!1},e.abortEditMode=function(){var o=this;o.isEditMode=!1,o.furnituring=o.furnituringBackup},e.saveFurnituring=function(){var o=this;a.save({FurnituringId:t.furnituringId,Name:o.furnituring.Name}).$promise.then(function(e){o.endEditMode(),s.show(s.simple().content('Möbleringen "'+o.furnituring.Name+'" sparades med ett lyckat resultat').position("top right"))})["catch"](function(e){409===e.status?s.show(s.simple().content('Det finns redan en möblering som heter "'+o.furnituring.Name+'". Två möbleringar kan inte heta lika.').position("top right")):400!==e.status&&500!==e.status||s.show(s.simple().content("Ett oväntat fel uppstod när möbleringen skulle sparas").position("top right")),404===e.status&&(s.show(s.simple().content('Möbleringen "'+o.furnituring.Name+'" existerar inte längre. Hann kanske någon radera den?').position("top right")),history.back())})},e.deleteFurnituring=function(){a["delete"]({furnituringId:t.furnituringId}).$promise.then(function(o){s.show(s.simple().content('Möbleringen "'+e.furnituring.Name+'" raderades med ett lyckat resultat').position("top right")),history.back()})["catch"](function(o){400===o.status&&"undefined"!==o.data.Message&&"Foreign key references exists"===o.data.Message?s.show(s.simple().content("Möbleringen kan inte raderas eftersom det finns en lokalbokning eller en lokalmöblering som refererar till möbleringen").position("top right")):400!==o.status&&500!==o.status||s.show(s.simple().content("Ett oväntat fel uppstod när möbleringen skulle tas bort").position("top right")),404===o.status&&s.show(s.simple().content('Möbleringen "'+e.furnituring.Name+'" existerar inte längre. Hann kanske någon radera den?').position("top right")),history.back()})},c(),l()}]).controller("FurnituringCreateCtrl",["$rootScope","$stateParams","$scope","$state","Furnituring","$mdToast",function(o,e,t,n,i,r){t.furnituring={},t.saveFurnituring=function(){var o=this;i.save({FurnituringId:0,Name:o.furnituring.Name}).$promise.then(function(e){r.show(r.simple().content('Möbleringen "'+o.furnituring.Name+'" skapades med ett lyckat resultat').position("top right")),history.back()})["catch"](function(e){409===e.status?r.show(r.simple().content('Det finns redan en möblering som heter "'+o.furnituring.Name+'". Två möbleringar kan inte heta lika.').position("top right")):r.show(r.simple().content("Ett oväntat fel uppstod när möbleringen skulle sparas").position("top right"))})}}]),angular.module("BookingSystem.mealsServices",["ngResource"]).factory("Meal",["$resource","API_URL",function(o,e){return o(e+"Meal/:mealId",{mealId:"@mealId"})}]).factory("MealHasPropertyHelper",["MealHasProperty","MealProperty",function(o,e){return{getCombined:function(t){var n=e.query(),i=o.queryForMealProperty({mealPropertyId:mealPropertyId});return n.$promise["finally"](function(){i.$promise["finally"](function(){n.forEach(function(o){var e=!1,t=void 0;for(t=0;t<i.length;t++)if(o.MealPropertyId===i[t].MealPropertyId){o.Selected=!0,e=!0;break}e||(o.Selected=!1)})})}),n}}}]),angular.module("BookingSystem.meals",[]).controller("MealsListCtrl",["$rootScope","$scope","$state","Meal","$mdToast",function(o,e,t,n,i){var r=function(){var o=n.query();o.$promise["catch"](function(){i.show(i.simple().content("Måltider kunde inte hämtas, var god försök igen.").position("top right"))}),e.meals=o};e.$on("$ionicView.enter",function(o,e){r()})}]).controller("MealDetailsCtrl",["$rootScope","$scope","$stateParams","MODAL_ANIMATION","$ionicModal","$state","Meal","MealProperty","MealHasProperty","$mdToast",function(o,e,t,n,i,r,a,s,u,c){var l="templates/modals/meals-delete.html";e.isEditMode=!1,e.mealBackup={};var m=function(){i.fromTemplateUrl(l,{scope:e,animation:n}).then(function(o){e.modal=o}),e.$on("$destroy",function(){e.modal.remove()})},d=function(){var o=a.get({mealId:t.mealId});o.$promise.then(function(){o.mealProperties=u.queryForMealProperty({mealPropertyId:t.mealPropertyId})})["catch"](function(){c.show(c.simple().content("Måltid kunde inte hämtas, var god försök igen.").position("top right"))}),e.meal=o},g=function(){e.mealProperties=s.query()};e.startEditMode=function(){var o=this;o.isEditMode=!0,o.mealBackup=angular.copy(o.meal)},e.endEditMode=function(){var o=this;o.isEditMode=!1},e.abortEditMode=function(){var o=this;o.isEditMode=!1,o.meal=o.mealBackup},e.saveMeal=function(){var o=this;a.save({MealId:t.mealId,Name:o.meal.Name}).$promise.then(function(e){o.endEditMode(),saveMealProperties(e.MealId).then(function(){c.show(c.simple().content('Måltiden "'+o.meal.Name+'" sparades med ett lyckat resultat').position("top right"))})["catch"](function(){c.show(c.simple().content("Uppgifter om måltiden sparades, men kostinformationen kunde inte sparas. Var god försök igen.").position("top right"))})})["catch"](function(e){409===e.status?c.show(c.simple().content('Det finns redan en måltid som heter "'+o.meal.Name+'". Två måltider kan inte heta lika.').position("top right")):400!==e.status&&500!==e.status||c.show(c.simple().content("Ett oväntat fel uppstod när måltiden skulle sparas").position("top right")),404===e.status&&(c.show(c.simple().content('Måltiden "'+o.meal.Name+'" existerar inte längre. Hann kanske någon radera den?').position("top right")),history.back())})},e.deleteMeal=function(){a["delete"]({mealId:t.mealId}).$promise.then(function(o){c.show(c.simple().content('Måltiden "'+e.meal.Name+'" raderades med ett lyckat resultat').position("top right")),history.back()})["catch"](function(o){400===o.status&&"undefined"!==o.data.Message&&"Foreign key references exists"===o.data.Message?c.show(c.simple().content("Måltiden kan inte raderas eftersom det finns en lokalbokning eller en lokalmåltid som refererar till måltiden").position("top right")):400!==o.status&&500!==o.status||c.show(c.simple().content("Ett oväntat fel uppstod när måltiden skulle tas bort").position("top right")),404===o.status&&c.show(c.simple().content('Måltiden "'+e.meal.Name+'" existerar inte längre. Hann kanske någon radera den?').position("top right")),history.back()})},m(),d(),g()}]).controller("MealCreateCtrl",["$rootScope","$stateParams","$scope","$state","Meal","$mdToast",function(o,e,t,n,i,r){t.meal={},t.saveMeal=function(){var o=this;i.save({MealId:0,Name:o.meal.Name}).$promise.then(function(e){r.show(r.simple().content('Måltiden "'+o.meal.Name+'" skapades med ett lyckat resultat').position("top right")),history.back()})["catch"](function(e){409===e.status?r.show(r.simple().content('Det finns redan en måltid som heter "'+o.meal.Name+'". Två måltider kan inte heta lika.').position("top right")):r.show(r.simple().content("Ett oväntat fel uppstod när måltiden skulle sparas").position("top right"))})}}]),angular.module("BookingSystem.mealPropertiesServices",["ngResource","BookingSystem.mealsServices"]).factory("MealProperty",["$resource","API_URL",function(o,e){return o(e+"MealProperty/:mealPropertyId",{mealPropertyId:"@mealPropertyId"})}]).factory("MealHasProperty",["$resource","API_URL",function(o,e){return o(e+"MealHasProperty/:mealPropertyId/:mealId",{mealPropertyId:"@mealPropertyId"},{remove:{url:e+"MealHasProperty/:mealPropertyId/:mealId",id:"@id",method:"DELETE",isArray:!1,params:{mealPropertyId:"@mealPropertyId",mealId:"@mealId"}},removeForMealProperty:{url:e+"MealHasProperty/:mealPropertyId",id:"@id",method:"DELETE",isArray:!1,params:{mealPropertyId:"@mealPropertyId"}},queryForMealProperty:{url:e+"MealHasProperty/:mealPropertyId",id:"@id",method:"GET",isArray:!0,params:{mealPropertyId:"@mealPropertyId"}},saveForMealProperty:{url:e+"MealHasProperty",id:"@id",method:"POST",isArray:!0}})}]),angular.module("BookingSystem.resourcesServices",["ngResource"]).factory("Resource",["$resource","API_URL",function(o,e){return o(e+"Resource/:resourceId",{resourceId:"@resourceId"},{queryFreeForPeriod:{url:e+"Resource/free/:fromDate/:toDate",id:"@id",method:"GET",isArray:!0,params:{fromDate:"@fromDate",toDate:"@toDate"}}})}]).factory("ResourceImage",["$http","API_URL",function(o,e){return{upload:function(t,n){return o({method:"POST",url:e+"Resource/image/"+n,data:t,headers:{"Content-Type":void 0}})}}}]),angular.module("BookingSystem.resources",[]).controller("ResourcesListCtrl",["$rootScope","$scope","$state","$mdToast","Resource",function(o,e,t,n,i){var r=function(){var o=i.query();o.$promise["catch"](function(){n.show(n.simple().content("Resurser kunde inte hämtas, var god försök igen.").position("top right"))}),e.resources=o};e.$on("$ionicView.enter",function(o,e){r()})}]).controller("ResourceDetailsCtrl",["$rootScope","$scope","$stateParams","MODAL_ANIMATION","$ionicModal","$state","Resource","ResourceImage","API_IMG_PATH_URL","$mdToast",function(o,e,t,n,i,r,a,s,u,c){var l="templates/modals/resources-delete.html";e.isEditMode=!1,e.resourceBackup={},e.API_IMG_PATH_URL=u,e.imgTime=Date.now();var m=function(){i.fromTemplateUrl(l,{scope:e,animation:n}).then(function(o){e.modal=o}),e.$on("$destroy",function(){e.modal.remove()})},d=function(o){return s.upload(e.resource.ImageForUpload,o)},g=function(){c.show(c.simple().content('Resursen "'+e.resource.Name+'" sparades med ett lyckat resultat').position("top right")),history.back()},p=function(){var o=a.get({resourceId:t.resourceId});o.$promise["catch"](function(){c.show(c.simple().content("Resurs kunde inte hämtas, var god försök igen.").position("top right"))}),e.resource=o};e.startEditMode=function(){var o=this;o.isEditMode=!0,o.resourceBackup=angular.copy(o.resource)},e.endEditMode=function(){var o=this;o.isEditMode=!1},e.abortEditMode=function(){var o=this;o.isEditMode=!1,o.resource=o.resourceBackup},e.saveResource=function(){var o=this;a.save({ResourceId:t.resourceId,Name:o.resource.Name,Count:o.resource.Count,ImageSrc:o.resource.ImageSrc,BookingPricePerHour:o.resource.BookingPricePerHour,MinutesMarginBeforeBooking:o.resource.MinutesMarginBeforeBooking,MinutesMarginAfterBooking:o.resource.MinutesMarginAfterBooking,WeekEndCount:o.resource.WeekEndCount}).$promise.then(function(e){o.endEditMode(),"undefined"!=typeof o.resource.ImageForUpload?d(e.ResourceId).success(function(){g()}).error(function(){c.show(c.simple().content("Resursen sparades, men det gick inte att ladda upp och spara den önskade bilden.").position("top right"))}):g()})["catch"](function(e){409===e.status?c.show(c.simple().content('Det finns redan en resurs som heter "'+o.resource.Name+'". Två resurser kan inte heta lika.').position("top right")):400!==e.status&&500!==e.status||c.show(c.simple().content("Ett oväntat fel uppstod när resursen skulle sparas").position("top right")),404===e.status&&(c.show(c.simple().content('Resursen "'+o.resource.Name+'" existerar inte längre. Hann kanske någon radera den?').position("top right")),history.back())})},e.deleteResource=function(){a["delete"]({resourceId:t.resourceId}).$promise.then(function(o){c.show(c.simple().content('Resursen "'+e.resource.Name+'" raderades med ett lyckat resultat').position("top right")),history.back()})["catch"](function(o){400===o.status&&"undefined"!==o.data.Message&&"Foreign key references exists"===o.data.Message?c.show(c.simple().content("Resursen kan inte raderas eftersom det finns en lokalbokning eller en lokalresurs som refererar till resursen").position("top right")):400!==o.status&&500!==o.status||c.show(c.simple().content("Ett oväntat fel uppstod när resursen skulle tas bort").position("top right")),404===o.status&&c.show(c.simple().content('Resursen "'+e.resource.Name+'" existerar inte längre. Hann kanske någon radera den?').position("top right")),history.back()})},m(),p()}]).controller("ResourceCreateCtrl",["$rootScope","$stateParams","$scope","$state","Resource","$mdToast",function(o,e,t,n,i,r){t.resource={},t.saveResource=function(){var o=this;i.save({ResourceId:0,Name:o.resource.Name,Count:o.resource.Count,BookingPricePerHour:o.resource.BookingPricePerHour,MinutesMarginBeforeBooking:o.resource.MinutesMarginBeforeBooking,MinutesMarginAfterBooking:o.resource.MinutesMarginAfterBooking,WeekEndCount:o.resource.WeekEndCount}).$promise.then(function(e){r.show(r.simple().content('Resursen "'+o.resource.Name+'" skapades med ett lyckat resultat').position("top right")),history.back()})["catch"](function(e){409===e.status?r.show(r.simple().content('Det finns redan en resurs som heter "'+o.resource.Name+'". Två resurser kan inte heta lika.').position("top right")):r.show(r.simple().content("Ett oväntat fel uppstod när resursen skulle sparas").position("top right"))})}}]),angular.module("BookingSystem.locationBooking",["ngMessages"]).controller("LocationBookingViewCtrl",["$rootScope","$scope","$state","LocationBooking","$interval","DATA_SYNC_INTERVAL_TIME","$ionicGesture","$mdToast","DEFAULT_CALENDAR_ZOOM",function(o,e,t,n,i,r,a,s,u){var c=r,l=null,m=null,d=null;e.zoom=u,e.weekDate=moment();var g=function(){var o=arguments.length<=0||void 0===arguments[0]?0:arguments[0];o>0?e.weekDate=moment(e.weekDate).add(1,"weeks"):0>o&&(e.weekDate=moment(e.weekDate).subtract(1,"weeks")),m=moment(e.weekDate).startOf("week"),d=moment(e.weekDate).endOf("week")},p=function(){var o=n.queryLessForPeriod({fromDate:m.format("YYYY-MM-DD"),toDate:d.format("YYYY-MM-DD")});o.$promise["catch"](function(){s.show(s.simple().content("Lokalbokningar kunde inte hämtas, var god försök igen.").position("top right"))}).then(function(o){e.locationBookings=o})},k=function(){l=i(function(){p()},c)},f=function(){var o=angular.element(document.querySelector("#booking-view-content"));a.on("pinch",function(o){o.gesture.srcEvent.preventDefault(),e.$apply(function(){e.zoom=o.gesture.scale})},o),a.on("swipeleft",function(o){e.toNextWeek(),e.$apply(),e.$broadcast("swipe-occurred")},o),a.on("swiperight",function(o){e.toPreviousWeek(),e.$apply(),e.$broadcast("swipe-occurred")},o)};e.toNextWeek=function(){g(1),p()},e.toPreviousWeek=function(){g(-1),p()},e.$on("$ionicView.beforeEnter",function(o,e){g(),p(),k()}),e.$on("$ionicView.loaded",function(o,e){f()}),e.$on("$ionicView.leave",function(o){l&&i.cancel(l),e.$broadcast("leaving-view")})}]).controller("LocationBookingDetailsCtrl",["$rootScope","$scope","$stateParams","MODAL_ANIMATION","$state","$ionicModal","LocationBooking","$mdToast","Location","Customer","BookingHelper","$q","$ionicHistory","API_IMG_PATH_URL",function(o,e,t,n,i,r,a,s,u,c,l,m,d,g){var p="templates/modals/location-booking-delete.html";e.editMode=!1,e.locationBookingBackup={},e.API_IMG_PATH_URL=g;var k=function(){r.fromTemplateUrl(p,{scope:e,animation:n}).then(function(o){e.modal=o}),e.$on("$destroy",function(){e.modal.remove()})},f=function(){var o=a.get({locationBookingId:t.id});return o.$promise["catch"](function(){s.show(s.simple().content("Lokalbokning kunde inte hämtas, var god försök igen.").position("top right"))}),e.locationBooking=o,o.$promise},h=function(){var o=e.locationBooking.StartTime,t=e.locationBooking.EndTime;e.bookingStartDate=moment(o).toDate(),e.bookingStartHour=moment(o).hour(),e.bookingStartMinute=moment(o).minute(),e.bookingEndDate=moment(t).toDate(),e.bookingEndHour=moment(t).hour(),e.bookingEndMinute=moment(t).minute()},b=function(){return"undefined"!=typeof e.bookingStartDate&&"undefined"!=typeof e.bookingStartHour&&"undefined"!=typeof e.bookingStartMinute&&"undefined"!=typeof e.bookingEndDate&&"undefined"!=typeof e.bookingEndHour&&"undefined"!=typeof e.bookingEndMinute},y=function(){e.selectHours=l.getHoursForSelect(),e.selectMinutes=l.getMinutesForSelect()},v=function(){if(b()){var o=B(e.bookingStartDate,e.bookingStartHour,e.bookingStartMinute),t=B(e.bookingEndDate,e.bookingEndHour,e.bookingEndMinute);u.queryFreeForPeriod({fromDate:o.format("YYYY-MM-DD"),fromTime:o.format("HH:mm"),toDate:t.format("YYYY-MM-DD"),toTime:t.format("HH:mm")}).$promise.then(function(o){e.locations=o})["catch"](function(o){s.show(s.simple().content("Ett oväntat fel uppstod när uppgifter om lediga lokaler skulle hämtas").position("top right"))})}},M=function(){var o=c.get({customerId:e.locationBooking.CustomerId});o.$promise["catch"](function(){s.show(s.simple().content("Kund kunde inte hämtas, var god försök igen.").position("top right"))}),e.customer=o},B=function(o,e,t){return moment(o).hour(e).minute(t)};e.startEditMode=function(){var o=this;o.isEditMode=!0,o.locationBookingBackup=angular.copy(o.locationBooking)},e.endEditMode=function(){var o=this;o.isEditMode=!1},e.abortEditMode=function(){var o=this;o.isEditMode=!1,o.locationBooking=o.locationBookingBackup},e.deleteLocationBooking=function(){a["delete"]({locationBookingId:t.id}).$promise.then(function(o){s.show(s.simple().content("Lokalbokningen raderades med ett lyckat resultat").position("top right")),history.back()})["catch"](function(o){400!==o.status&&500!==o.status||s.show(s.simple().content("Ett oväntat fel uppstod när Lokalbokningen skulle tas bort").position("top right")),404===o.status&&s.show(s.simple().content("Lokalbokningen existerar inte längre. Hann kanske någon radera den?").position("top right")),history.back()})},e.updateFurniturings=function(){e.locationBooking.LocationId?(e.furniturings=LocationFurnituring.queryForLocation({locationId:e.locationBooking.LocationId}),e.furniturings.$promise["catch"](function(){s.show(s.simple().content("Möbleringar för vald lokal kunde inte hämtas.").position("top right"))})):e.furnituring=[]},e.checkEndDate=function(){if(b()){var o=B(e.bookingStartDate,e.bookingStartHour,e.bookingStartMinute).toDate().getTime(),t=B(e.bookingEndDate,e.bookingEndHour,e.bookingEndMinute).toDate().getTime();o>t&&(e.bookingEndDate=e.bookingStartDate,e.bookingEndHour=e.bookingStartHour,e.bookingEndMinute=e.bookingStartMinute+15),v()}},e.saveLocationBooking=function(){var o=this,e=m.defer(),t=e.promise,n=o.locationBooking.SelectedFurnituring?o.locationBooking.SelectedFurnituring.FurnituringId:null;return a.save({BookingId:o.locationBooking.BookingId,LocationBookingId:o.locationBooking.LocationBookingId,LocationId:o.locationBooking.LocationId,FurnituringId:n,StartTime:B(o.bookingStartDate,o.bookingStartHour,o.bookingStartMinute).format(),EndTime:B(o.bookingEndDate,o.bookingEndHour,o.bookingEndMinute).format(),NumberOfPeople:o.locationBooking.NumberOfPeople,Provisional:o.locationBooking.Provisional}).$promise.then(function(o){s.show(s.simple().content("Lokal/plats-bokningen sparades med ett lyckat resultat").position("top right")),e.resolve(),d.goBack()})["catch"](function(o){409===o.status?s.show(s.simple().content("Lokalen är tyvärr redan bokad under vald tidsram.").position("top right")):s.show(s.simple().content("Ett oväntat fel uppstod när lokal/plats-bokningen skulle sparas").position("top right"))}),t},k(),f().then(function(){h(),M()}),v(),y()}]).controller("LocationBookingCreateCtrl",["$rootScope","$stateParams","$scope","$state","LocationBooking","Location","BookingHelper","LocationFurnituring","Customer","$q","$mdToast","$ionicHistory","API_IMG_PATH_URL","PHOTO_MISSING_SRC",function(o,e,t,n,i,r,a,s,u,c,l,m,d,g){t.locationBooking={Provisional:!0,BookingTypeId:1},t.furnituring=[],t.API_IMG_PATH_URL=d,t.customerImageSrc=g;var p=function(){n.params.date?(t.bookingStartDate=moment(n.params.date).toDate(),t.bookingStartHour=moment(n.params.date).hour(),t.bookingStartMinute=moment(n.params.date).minute(),t.bookingEndDate=moment(n.params.date).toDate(),t.bookingEndHour=moment(n.params.date).hour(),t.bookingEndMinute=moment(n.params.date).add(59,"minutes").minute()):(t.bookingStartDate=new Date,t.bookingStartHour=8,t.bookingStartMinute=0,t.bookingEndDate=new Date,t.bookingEndHour=8,t.bookingEndMinute=59)},k=function(){return"undefined"!=typeof t.bookingStartDate&&"undefined"!=typeof t.bookingStartHour&&"undefined"!=typeof t.bookingStartMinute&&"undefined"!=typeof t.bookingEndDate&&"undefined"!=typeof t.bookingEndHour&&"undefined"!=typeof t.bookingEndMinute},f=function(){t.selectHours=a.getHoursForSelect(),t.selectMinutes=a.getMinutesForSelect()},h=function(){if(k()){var o=M(t.bookingStartDate,t.bookingStartHour,t.bookingStartMinute),e=M(t.bookingEndDate,t.bookingEndHour,t.bookingEndMinute);r.queryFreeForPeriod({fromDate:o.format("YYYY-MM-DD"),fromTime:o.format("HH:mm"),toDate:e.format("YYYY-MM-DD"),toTime:e.format("HH:mm")}).$promise.then(function(o){t.locations=o})["catch"](function(o){l.show(l.simple().content("Ett oväntat fel uppstod när uppgifter om lediga lokaler skulle hämtas").position("top right"))})}},b=function(){var o=u.query();o.$promise["catch"](function(){l.show(l.simple().content("Kunder kunde inte hämtas, var god försök igen.").position("top right"))}),t.customers=o},y=function(){t.customerImageSrc=null!==t.customer.ImageSrc&&t.customer.ImageSrc.length>1?d+t.customer.ImageSrc:g;
},v=function(){var o=u.get({customerId:n.params.customerId});o.$promise["catch"](function(){l.show(l.simple().content("Kund kunde inte hämtas, var god försök igen.").position("top right"))}).then(function(){y()}),t.customer=o},M=function(o,e,t){return moment(o).hour(e).minute(t)},B=function(){var o=c.defer();return null!==n.params.bookingId?(t.locationBooking.BookingId=n.params.bookingId,o.resolve()):a.createBookingContainer(t.locationBooking).then(function(e){t.locationBooking.BookingId=e.BookingId,o.resolve()})["catch"](function(e){l.show(l.simple().content("Ett oväntat fel uppstod när bokningstillfället skulle skapas").position("top right")),o.reject()}),o.promise};t.updateFurniturings=function(){t.locationBooking.LocationId?(t.furniturings=s.queryForLocation({locationId:t.locationBooking.LocationId}),t.furniturings.$promise["catch"](function(){l.show(l.simple().content("Möbleringar för vald lokal kunde inte hämtas.").position("top right"))})):t.furnituring=[]},t.checkEndDate=function(){if(k()){var o=M(t.bookingStartDate,t.bookingStartHour,t.bookingStartMinute).toDate().getTime(),e=M(t.bookingEndDate,t.bookingEndHour,t.bookingEndMinute).toDate().getTime();o>e&&(t.bookingEndDate=t.bookingStartDate,t.bookingEndHour=t.bookingStartHour,t.bookingEndMinute=t.bookingStartMinute+15),h()}},t.saveLocationBooking=function(){var o=this,e=c.defer(),t=e.promise;return B().then(function(){var t=o.locationBooking.SelectedFurnituring?o.locationBooking.SelectedFurnituring.FurnituringId:null;i.save({BookingId:o.locationBooking.BookingId,LocationBookingId:0,LocationId:o.locationBooking.LocationId,FurnituringId:t,StartTime:M(o.bookingStartDate,o.bookingStartHour,o.bookingStartMinute).format(),EndTime:M(o.bookingEndDate,o.bookingEndHour,o.bookingEndMinute).format(),NumberOfPeople:o.locationBooking.NumberOfPeople,Provisional:o.locationBooking.Provisional}).$promise.then(function(o){l.show(l.simple().content("Lokal/plats-bokningen skapades med ett lyckat resultat").position("top right")),e.resolve(),m.goBack()})["catch"](function(o){409===o.status?l.show(l.simple().content("Lokalen är tyvärr redan bokad under vald tidsram.").position("top right")):l.show(l.simple().content("Ett oväntat fel uppstod när lokal/plats-bokningen skulle sparas").position("top right"))})}),t},p(),h(),f(),n.params.customerId?v():b()}]),angular.module("BookingSystem.locationBookingServices",["ngResource"]).factory("LocationBooking",["$resource","API_URL",function(o,e){return o(e+"LocationBooking/:locationBookingId",{locationBookingId:"@locationBookingId"},{queryLessForPeriod:{url:e+"LocationBooking/period/:fromDate/:toDate/less",id:"@id",method:"GET",isArray:!0,params:{fromDate:"@fromDate",toDate:"@toDate"}},queryMoreForPeriod:{url:e+"LocationBooking/period/:fromDate/:toDate/more",id:"@id",method:"GET",isArray:!0,params:{fromDate:"@fromDate",toDate:"@toDate"}}})}]),angular.module("BookingSystem.locationsServices",["ngResource"]).factory("Location",["$resource","API_URL",function(o,e){return o(e+"Location/:locationId",{locationId:"@locationId"},{queryFreeForPeriod:{url:e+"Location/free/:fromDate/:toDate",id:"@id",method:"GET",isArray:!0,params:{fromDate:"@fromDate",toDate:"@toDate"}},querySearch:{url:e+"Location/search/:column",id:"@id",method:"GET",isArray:!0,params:{column:"@column"}}})}]).factory("LocationImage",["$http","API_URL",function(o,e){return{upload:function(t,n){return o({method:"POST",url:e+"Location/image/"+n,data:t,headers:{"Content-Type":void 0}})}}}]),angular.module("BookingSystem.locations",["uiGmapgoogle-maps"]).config(["$stateProvider","uiGmapGoogleMapApiProvider",function(o,e){e.configure({v:"3.17",libraries:"weather,geometry,visualization",language:"sv"})}]).controller("LocationsListCtrl",["$rootScope","$scope","$state","$mdToast","Location",function(o,e,t,n,i){var r=function(){var o=i.query();o.$promise["catch"](function(){n.show(n.simple().content("Lokaler och platser kunde inte hämtas, var god försök igen.").position("top right"))}),e.locations=o};e.$on("$ionicView.enter",function(o,e){r()})}]).controller("LocationDetailsCtrl",["$rootScope","$scope","$stateParams","MODAL_ANIMATION","$state","$ionicModal","$mdToast","Location","LocationImage","API_IMG_PATH_URL","DEFAULT_MAP_ZOOM","DEFAULT_LONGITUDE","DEFAULT_LATITUDE",function(o,e,t,n,i,r,a,s,u,c,l,m,d){var g="templates/modals/location-delete.html";e.editMode=!1,e.locationBackup={},e.API_IMG_PATH_URL=c,e.markers=[];var p=function(){r.fromTemplateUrl(g,{scope:e,animation:n}).then(function(o){e.modal=o}),e.$on("$destroy",function(){e.modal.remove()})},k=function(o){return u.upload(e.location.ImageForUpload,o)},f=function(){a.show(a.simple().content('Lokalen/Platsen "'+e.location.Name+'" sparades med ett lyckat resultat').position("top right")),history.back()},h=function(){e.map={center:{latitude:d,longitude:m},zoom:l,bounds:{},options:{mapTypeId:google.maps.MapTypeId.SATELLITE}}},b=function(){e.markers[0]={id:e.location.LocationId,coords:{latitude:e.location.GPSLatitude,longitude:e.location.GPSLongitude}},e.map.center={latitude:e.location.GPSLatitude,longitude:e.location.GPSLongitude},e.map.zoom=18},y=function(){var o=s.get({locationId:t.locationId});o.$promise["catch"](function(){a.show(a.simple().content("Lokal/plats kunde inte hämtas, var god försök igen.").position("top right"))}),e.location=o};e.startEditMode=function(){var o=this;o.isEditMode=!0,o.locationBackup=angular.copy(o.location)},e.endEditMode=function(){var o=this;o.isEditMode=!1},e.abortEditMode=function(){var o=this;o.isEditMode=!1,o.location=o.locationBackup},e.saveLocation=function(){var o=this;s.save({LocationId:t.locationId,Name:o.location.Name,MaxPeople:o.location.MaxPeople,ImageSrc:o.location.ImageSrc,BookingPricePerHour:o.location.BookingPricePerHour,MinutesMarginBeforeBooking:o.location.MinutesMarginBeforeBooking,MinutesMarginAfterBooking:o.location.MinutesMarginAfterBooking}).$promise.then(function(e){o.endEditMode(),"undefined"!=typeof o.location.ImageForUpload?k(e.LocationId).success(function(){f()}).error(function(){a.show(a.simple().content("Lokalen/Platsen sparades, men det gick inte att ladda upp och spara den önskade bilden.").position("top right"))}):f()})["catch"](function(e){409===e.status?a.show(a.simple().content('Det finns redan en lokal/plats som heter "'+o.location.Name+'". Två lokaler eller platser kan inte heta lika.').position("top right")):400!==e.status&&500!==e.status||a.show(a.simple().content("Ett oväntat fel uppstod när lokalen/platsen skulle sparas").position("top right")),404===e.status&&(a.show(a.simple().content('Lokalen/platsen "'+o.location.Name+'" existerar inte längre. Hann kanske någon radera den?').position("top right")),history.back())})},e.deleteLocation=function(){s["delete"]({locationId:t.locationId}).$promise.then(function(o){a.show(a.simple().content('Lokalen/platsen "'+e.location.Name+'" raderades med ett lyckat resultat').position("top right")),history.back()})["catch"](function(o){400===o.status&&"undefined"!==o.data.Message&&"Foreign key references exists"===o.data.Message?a.show(a.simple().content("Lokalen/platsen kan inte raderas eftersom det finns en bokning eller en lokalmöblering som refererar till lokalen/platsen").position("top right")):400!==o.status&&500!==o.status||a.show(a.simple().content("Ett oväntat fel uppstod när lokalen/platsen skulle tas bort").position("top right")),404===o.status&&a.show(a.simple().content('Lokalen/platsen "'+e.location.Name+'" existerar inte längre. Hann kanske någon radera den?').position("top right")),history.back()})},p(),y(),h(),e.$watch(function(){return e.map.bounds},function(o,e){!e.southwest&&o.southwest&&b()},!0)}]).controller("LocationCreateCtrl",["$rootScope","$stateParams","$scope","$state","$mdToast","Location","LocationImage",function(o,e,t,n,i,r,a){t.location={};var s=function(o){return a.upload(t.location.ImageForUpload,o)},u=function(){i.show(i.simple().content('Lokalen/Platsen "'+t.location.Name+'" sparades med ett lyckat resultat').position("top right")),history.back()};t.saveLocation=function(){var o=this;r.save({LocationId:0,Name:o.location.Name,MaxPeople:o.location.MaxPeople,ImageSrc:o.location.ImageSrc,BookingPricePerHour:o.location.BookingPricePerHour,MinutesMarginBeforeBooking:o.location.MinutesMarginBeforeBooking,MinutesMarginAfterBooking:o.location.MinutesMarginAfterBooking}).$promise.then(function(e){"undefined"!=typeof o.location.ImageForUpload?s(e.LocationId).success(function(){u()}).error(function(){i.show(i.simple().content("Lokalen/Platsen sparades, men det gick inte att ladda upp och spara den önskade bilden.").position("top right"))}):u()})["catch"](function(e){409===e.status?i.show(i.simple().content('Det finns redan en lokal eller plats som heter "'+o.location.Name+'". Två lokaler/platser kan inte heta lika.').position("top right")):i.show(i.simple().content("Ett oväntat fel uppstod när lokalen/platsen skulle sparas").position("top right"))})}}]),angular.module("BookingSystem.calendarWeekDirective",[]).controller("CalendarWeekCtrl",["$rootScope","$scope","$state","LocationBooking","BookingHelper",function(o,e,t,n,i){e.days=[];var r=function(o,e,t){return i.doBookingsCollide(t.StartTime,t.EndTime,o,e)},a=function(o){var t=void 0;for(t=0;7>t;t++){var n=moment(e.days[t].date),i=moment(n).endOf("day"),a=e.bookings.filter(r.bind(null,n,i));e.days[t].bookings=[],a.forEach(function(o){e.days[t].bookings.push(JSON.parse(JSON.stringify(o)))})}},s=function(){e.weekDateStart=moment(e.date).startOf("isoWeek");for(var o=0,t=moment(e.weekDateStart);7>o;t.add(1,"days"))e.days[o]={},e.days[o].date=t.format(),o++},u=function(o){e.$broadcast("hideAllAddButtons",!0)};e.hideAddButtons=function(o){u()},s(),e.$watch("bookings",function(o){void 0!==o&&a()}),e.$watch("date",function(o,e){s()})}]).directive("calendarWeek",[function(){return{restrict:"E",replace:!0,templateUrl:function(o,e){return"templates/directives/calendar-week.html"},scope:{date:"=",bookings:"=",bookingsType:"=",zoom:"="},link:function(o,e,t){},controller:"CalendarWeekCtrl"}}]),angular.module("BookingSystem.calendarDayDirective",[]).controller("CalendarDayCtrl",["$scope","$element","$attrs","$rootScope","$location","$q","$state","BookingHelper","$interval","DEFAULT_CALENDAR_ZOOM","$ionicScrollDelegate","$window","$document","$ionicModal","MODAL_ANIMATION","BOOKING_TYPES",function(o,e,t,n,i,r,a,s,u,c,l,m,d,g,p,k){var f="templates/modals/booking-create-choose-type.html",h=moment(o.date),b=6e4,y=200,v=35,M=null;o.dayNumber=h.format("D"),o.dayName=h.format("ddd"),o.visibleAddButtonHour=null,o.columnHeight=v*o.zoom,o.bookingTypes=k;var B=function(){"booking"===o.bookingsType&&(g.fromTemplateUrl(f,{scope:o,animation:p}).then(function(e){o.modal=e}),o.$on("$destroy",function(){o.modal.remove()}))},I=function(){var e=void 0,t=24;for(o.hoursArray=[],e=0;t>e;e++)o.hoursArray.push(e)},$=function(o,e){return Number(o)+Number(e/60)},D=function(){var e=o.columnHeight+v*(o.zoom-1);y>e&&e>v&&(o.columnHeight=e)},S=function(){o.isCurrentDay&&d.ready(function(){var e=angular.element(document.querySelector(".time-line")).prop("offsetTop");l.scrollTo(0,e-o.columnHeight,!1)})},w=function(){if(o.isCurrentDay=moment().format("YYYY-MM-DD")===h.format("YYYY-MM-DD"),o.isCurrentDay){var e=moment(),t=e.format("H"),n=e.format("mm");o.currentHour=$(t,n)}else o.isDayOld=h.isBefore(moment())},E=function(){o.isCurrentDay&&(M=u(function(){w()},b))},T=function(o){var e=moment(o.EndTime).startOf("day"),t=moment(o.StartTime).format("H"),n=moment(o.StartTime).format("mm");return h.date()!==moment(o.StartTime).date()&&moment(o.StartTime).isBefore(e)?0:$(t,n)},P=function(o){return moment(o.EndTime).isAfter(moment(h).endOf("day"))?23.99:Number(moment(o.EndTime).format("H"))+Number(moment(o.EndTime).format("mm")/60)},C=function(){void 0!==o.bookings&&o.bookings.forEach(function(e){e.StartHour=T(e),e.EndHour=P(e),e.Duration=e.EndHour-e.StartHour,s.setConcurrentBookingData(e,o.bookings)})};o.showAddHour=function(e){o.hideAllAddButtonsCallback(),o.visibleAddButtonHour=e},o.hideAddButton=function(){o.visibleAddButtonHour=null},o.createEventForHour=function(e,t){var n=t||o.bookingsType;h.set({hour:e}),"booking"===n?o.modal.show():(a.go("app."+n+"-create",{date:h,id:null}),o.hideAddButton())},o.createBookingOfType=function(e){o.createEventForHour(h.hour(),e),o.modal.hide()},o.showEvent=function(e){a.go("app."+o.bookingsType+"-details",{id:e})},I(),w(),E(),S(),B(),o.$on("hideAllAddButtons",function(e,t){o.hideAddButton()}),o.$watch("bookings",function(o,e){Array.isArray(o)&&C()}),o.$watch("zoom",function(o,e){D()}),o.$on("swipe-occurred",function(e){o.columnHeight=v*c}),o.$on("leaving-view",function(o){null!==M&&u.cancel(M)})}]).directive("calendarDay",[function(){return{restrict:"E",replace:!0,templateUrl:function(o,e){return"templates/directives/calendar-day.html"},scope:{date:"=",hideAllAddButtonsCallback:"&",hideAddButton:"=",bookings:"=",bookingsType:"=",zoom:"="},link:function(o,e,t){},controller:"CalendarDayCtrl"}}]).controller("CalendarTimeCtrl",["$scope","DEFAULT_CALENDAR_ZOOM",function(o,e){var t=35;o.columnHeight=t*o.zoom;var n=200,i=function(){o.weekNumber=moment(o.date).isoWeek()},r=function(){var e=o.columnHeight+t*(o.zoom-1);n>e&&e>t&&(o.columnHeight=e)},a=function(){var e=void 0,t=24;for(o.hoursArray=[],e=1;t>e;e++)o.hoursArray.push(e)};a(),i(),o.$watch("zoom",function(o,e){r()}),o.$watch("date",function(o,e){i()}),o.$on("swipe-occurred",function(n){o.columnHeight=t*e})}]).directive("calendarTime",[function(){return{restrict:"E",replace:!0,scope:{date:"=",zoom:"="},templateUrl:function(o,e){return"templates/directives/calendar-time.html"},controller:"CalendarTimeCtrl"}}]).filter("digits",function(){return function(o){return 10>o&&(o="0"+o),o}}),angular.module("BookingSystem.customersServices",["ngResource"]).factory("Customer",["$resource","API_URL",function(o,e){return o(e+"Customer/:customerId",{customerId:"@customerId"})}]).factory("CustomerImage",["$http","API_URL",function(o,e){return{upload:function(t,n){return o({method:"POST",url:e+"Customer/image/"+n,data:t,headers:{"Content-Type":void 0}})}}}]),angular.module("BookingSystem.customers",[]).controller("CustomersListCtrl",["$rootScope","$scope","$state","Customer","$mdToast",function(o,e,t,n,i){var r=function(){var o=n.query();o.$promise["catch"](function(){i.show(i.simple().content("Kunder kunde inte hämtas, var god försök igen.").position("top right"))}),e.customers=o};e.$on("$ionicView.enter",function(o,e){r()})}]).controller("CustomerDetailsCtrl",["$rootScope","$scope","$stateParams","MODAL_ANIMATION","$ionicModal","$state","Customer","CustomerImage","API_IMG_PATH_URL","$mdToast",function(o,e,t,n,i,r,a,s,u,c){var l="templates/modals/customers-delete.html";e.isEditMode=!1,e.customerBackup={},e.API_IMG_PATH_URL=u;var m=function(){i.fromTemplateUrl(l,{scope:e,animation:n}).then(function(o){e.modal=o}),e.$on("$destroy",function(){e.modal.remove()})},d=function(o){return s.upload(e.customer.ImageForUpload,o)},g=function(){c.show(c.simple().content('Kunden "'+e.customer.Name+'" sparades med ett lyckat resultat').position("top right")),history.back()},p=function(){var o=a.get({customerId:t.customerId});o.$promise["catch"](function(){c.show(c.simple().content("Kunden kunde inte hämtas, var god försök igen.").position("top right"))}),e.customer=o};e.startEditMode=function(){var o=this;o.isEditMode=!0,o.customerBackup=angular.copy(o.customer)},e.endEditMode=function(){var o=this;o.isEditMode=!1},e.abortEditMode=function(){var o=this;o.isEditMode=!1,o.customer=o.customerBackup},e.saveCustomer=function(){var o=this;a.save({CustomerId:t.customerId,Name:o.customer.Name,Address:o.customer.Address,PostNumber:o.customer.PostNumber,City:o.customer.City,EmailAddress:o.customer.EmailAddress,PhoneNumber:o.customer.PhoneNumber,CellPhoneNumber:o.customer.CellPhoneNumber,ParentCustomerId:o.customer.ParentCustomerId,ImageSrc:o.customer.ImageSrc,Notes:o.customer.Notes}).$promise.then(function(e){o.endEditMode(),"undefined"!=typeof o.customer.ImageForUpload?d(e.CustomerId).success(function(){g()}).error(function(){c.show(c.simple().content("Kunden sparades, men det gick inte att ladda upp och spara den önskade bilden.").position("top right"))}):g()})["catch"](function(e){409===e.status?c.show(c.simple().content('Det finns redan en kund som heter "'+o.customer.Name+'". Två kunder kan inte heta lika.').position("top right")):400!==e.status&&500!==e.status||c.show(c.simple().content("Ett oväntat fel uppstod när kunden skulle sparas").position("top right")),404===e.status&&(c.show(c.simple().content('Kunden "'+o.customer.Name+'" existerar inte längre. Hann kanske någon radera den?').position("top right")),history.back())})},e.deleteCustomer=function(){a["delete"]({customerId:t.customerId}).$promise.then(function(o){c.show(c.simple().content('Kunden "'+e.customer.Name+'" raderades med ett lyckat resultat').position("top right")),history.back()})["catch"](function(t){400===t.status&&"undefined"!==t.data.Message&&"Foreign key references exists"===t.data.Message?c.show(c.simple().content("Kunden kan inte raderas eftersom det finns en bokning som refererar till kunden").position("top right")):400!==t.status&&500!==t.status||c.show(c.simple().content("Ett oväntat fel uppstod när kunden skulle tas bort").position("top right")),404===t.status&&(c.show(c.simple().content('Kunden "'+e.customer.Name+'" existerar inte längre. Hann kanske någon radera den?').position("top right")),o.FlashMessage={type:"error",message:""}),history.back()})},m(),p()}]).controller("CustomerCreateCtrl",["$rootScope","$stateParams","$scope","$state","Customer","CustomerImage","$mdToast",function(o,e,t,n,i,r,a){t.customer={};var s=function(o){return r.upload(t.customer.ImageForUpload,o)},u=function(){a.show(a.simple().content('Kunden "'+t.customer.Name+'" sparades med ett lyckat resultat').position("top right")),history.back()};t.saveCustomer=function(){var o=this;i.save({CustomerId:0,Name:o.customer.Name,Address:o.customer.Address,PostNumber:o.customer.PostNumber,City:o.customer.City,EmailAddress:o.customer.EmailAddress,PhoneNumber:o.customer.PhoneNumber,CellPhoneNumber:o.customer.CellPhoneNumber,ParentCustomerId:o.customer.ParentCustomerId,ImageSrc:o.customer.ImageSrc,Notes:o.customer.Notes}).$promise.then(function(e){"undefined"!=typeof o.customer.ImageForUpload?s(e.CustomerId).success(function(o){u()}).error(function(){a.show(a.simple().content('Kunden "'+o.customer.Name+'" skapades, men det gick inte att ladda upp och spara den önskade bilden.').position("top right")),history.back()}):u()})["catch"](function(e){409===e.status?a.show(a.simple().content('Det finns redan en kund som heter "'+o.customer.Name+'". Två kunder kan inte heta lika.').position("top right")):a.show(a.simple().content("Ett oväntat fel uppstod när kunden skulle sparas").position("top right"))})}}]),angular.module("BookingSystem.bookingTypesServices",["ngResource"]).factory("BookingType",["$resource","API_URL",function(o,e){return o(e+"BookingType/:bookingTypeId",{bookingTypeId:"@bookingTypeId"})}]),angular.module("BookingSystem.bookingTypes",[]).controller("BookingTypesListCtrl",["$rootScope","$scope","$state","BookingType","$mdToast",function(o,e,t,n,i){var r=function(){var o=n.query();o.$promise["catch"](function(){i.show(i.simple().content("Bokningstyper kunde inte hämtas, var god försök igen.").position("top right"))}),e.bookingTypes=o};e.$on("$ionicView.enter",function(o,e){r()})}]).controller("BookingTypeDetailsCtrl",["$rootScope","$scope","$stateParams","MODAL_ANIMATION","$ionicModal","$state","BookingType","$mdToast",function(o,e,t,n,i,r,a,s){var u="templates/modals/bookingtypes-delete.html";e.isEditMode=!1,e.bookingTypeBackup={};var c=function(){i.fromTemplateUrl(u,{scope:e,animation:n}).then(function(o){e.modal=o}),e.$on("$destroy",function(){e.modal.remove()})},l=function(){var o=a.get({bookingTypeId:t.bookingTypeId});o.$promise["catch"](function(){s.show(s.simple().content("Bokningstypen kunde inte hämtas, var god försök igen.").position("top right"))}),e.bookingType=o};e.toggleHasLocation=function(){var o=this;console.log(o.bookingType.HasLocation),o.bookingType.HasLocation===!0?o.bookingType.HasLocation=!1:o.bookingType.HasLocation=!0},e.startEditMode=function(){var o=this;o.isEditMode=!0,o.bookingTypeBackup=angular.copy(o.bookingType)},e.endEditMode=function(){var o=this;o.isEditMode=!1},e.abortEditMode=function(){var o=this;o.isEditMode=!1,o.bookingType=o.bookingTypeBackup},e.saveBookingType=function(){var o=this;a.save({BookingTypeId:t.bookingTypeId,Name:o.bookingType.Name}).$promise.then(function(e){o.endEditMode(),s.show(s.simple().content('Bokningstypen "'+o.bookingType.Name+'" sparades med ett lyckat resultat').position("top right"))})["catch"](function(e){409===e.status?s.show(s.simple().content('Det finns redan en bokningstyp som heter "'+o.bookingType.Name+'". Två boknigstyper kan inte heta lika.').position("top right")):400!==e.status&&500!==e.status||s.show(s.simple().content("Ett oväntat fel uppstod när bokningstypen skulle sparas").position("top right")),404===e.status&&(s.show(s.simple().content('Bokningstypen "'+o.bookingType.Name+'" existerar inte längre. Hann kanske någon radera den?').position("top right")),history.back())})},e.deleteBookingType=function(){a["delete"]({bookingTypeId:t.bookingTypeId}).$promise.then(function(o){s.show(s.simple().content('Bokningstypen "'+e.bookingType.Name+'" raderades med ett lyckat resultat').position("top right")),history.back()})["catch"](function(o){400===o.status&&"undefined"!==o.data.Message&&"Foreign key references exists"===o.data.Message?s.show(s.simple().content("Bokningstypen kan inte raderas eftersom det finns en bokning som refererar till bokningstypen").position("top right")):400!==o.status&&500!==o.status||s.show(s.simple().content("Ett oväntat fel uppstod när bokningstypen skulle tas bort").position("top right")),404===o.status&&s.show(s.simple().content('Bokningstypen "'+e.bookingType.Name+'" existerar inte längre. Hann kanske någon radera den?').position("top right")),history.back()})},c(),l()}]).controller("BookingTypeCreateCtrl",["$rootScope","$stateParams","$scope","$state","BookingType","$mdToast",function(o,e,t,n,i,r){t.bookingType={},t.bookingType.HasLocation=!1,t.toggleHasLocation=function(){var o=this;o.bookingType.HasLocation===!0?o.bookingType.HasLocation=!1:o.bookingType.HasLocation=!0},t.saveBookingType=function(){var o=this;i.save({BookingTypeId:0,Name:o.bookingType.Name,HasLocation:o.bookingType.HasLocation,MinutesMarginBeforeBooking:o.bookingType.MinutesMarginBeforeBooking,MinutesMarginAfterBooking:o.bookingType.MinutesMarginAfterBooking}).$promise.then(function(e){r.show(r.simple().content('Bokningstypen "'+o.bookingType.Name+'" skapades med ett lyckat resultat').position("top right")),history.back()})["catch"](function(e){409===e.status?r.show(r.simple().content('Det finns redan en bokningstyp som heter "'+o.bookingType.Name+'". Två bokningstyper kan inte heta lika.').position("top right")):r.show(r.simple().content("Ett oväntat fel uppstod när bokningstypen skulle sparas").position("top right"))})}}]),angular.module("BookingSystem.bookingHelperServices",[]).factory("BookingHelper",["$q","Booking",function(o,e){var t=function(o,e,t,n){return o=moment(o),e=moment(e),t=moment(t),n=moment(n),o.isBefore(n)&&e.isAfter(n)||o.isBefore(t)&&e.isAfter(t)||o.isSameOrAfter(t)&&e.isSameOrBefore(n)},n=function(o,e){var n=[],i=0,r=void 0;for(r=0;r<e.length;r++)t(o.StartTime,o.EndTime,e[r].StartTime,e[r].EndTime)&&n.push(e[r]);o.ConcurrentBookings=n.length,n.length&&(n.sort(function(o,e){return o.StartTime>=e.StartTime&&o.EndTime<=e.EndTime}),i=n.findIndex(function(e){return o.Id===e.Id})),o.ConcurrentBookingIndex=i},i=function(){for(var o=[],e=0;23>=e;e++)o.push(e);return o},r=function(){for(var o=[],e=0;59>=e;e++)o.push(e);return o},a=function(o){return e.save({BookingId:0,Name:"",BookingTypeId:o.BookingTypeId,CustomerId:o.CustomerId,Provisional:1,NumberOfPeople:o.NumberOfPeople||0,Discount:0,CreatedByUserId:1,ModifiedByUserId:1,ResponsibleUserId:1}).$promise};return{doBookingsCollide:t,setConcurrentBookingData:n,getHoursForSelect:i,getMinutesForSelect:r,createBookingContainer:a}}]),angular.module("BookingSystem.imageResizeServices",[]).factory("ImageResize",["UPLOAD_IMG_MAX_WIDTH","UPLOAD_IMG_MAX_HEIGHT","$q",function(o,e,t){var n=void 0,i=void 0,r=void 0,a=void 0,s=function(o){var e=document.createElement("canvas");return e.width=o.width/2,e.height=o.height/2,e.getContext("2d").drawImage(o,0,0,e.width,e.height),e},u=function(o,e,t){function n(o,e,t,n,i,r){var a=1-i,s=1-r;return o*a*s+e*i*s+t*a*r+n*i*r}var i=void 0,r=void 0,a=void 0,s=void 0,u=void 0,c=void 0,l=void 0,m=void 0,d=void 0,g=void 0,p=void 0,k=void 0,f=void 0,h=void 0,b=void 0,y=void 0,v=void 0,M=void 0,B=void 0;for(i=0;i<e.height;++i)for(a=i/t,s=Math.floor(a),u=Math.ceil(a)>o.height-1?o.height-1:Math.ceil(a),r=0;r<e.width;++r)c=r/t,l=Math.floor(c),m=Math.ceil(c)>o.width-1?o.width-1:Math.ceil(c),d=4*(r+e.width*i),g=4*(l+o.width*s),p=4*(m+o.width*s),k=4*(l+o.width*u),f=4*(m+o.width*u),h=c-l,b=a-s,y=n(o.data[g],o.data[p],o.data[k],o.data[f],h,b),e.data[d]=y,v=n(o.data[g+1],o.data[p+1],o.data[k+1],o.data[f+1],h,b),e.data[d+1]=v,M=n(o.data[g+2],o.data[p+2],o.data[k+2],o.data[f+2],h,b),e.data[d+2]=M,B=n(o.data[g+3],o.data[p+3],o.data[k+3],o.data[f+3],h,b),e.data[d+3]=B},c=function(t){var n=void 0;return n=t.width>t.height?o/t.width:e/t.height},l=function(o){var e=document.createElement("canvas"),t=c(o);e.width=o.width*t,e.height=o.height*t;var n=o.getContext("2d").getImageData(0,0,o.width,o.height),i=e.getContext("2d").createImageData(e.width,e.height);return u(n,i,t),e.getContext("2d").putImageData(i,0,0),e};return{scaleImage:function(u){return n=document.createElement("img"),i=document.createElement("canvas"),r=t.defer(),n.src=u,n.onload=function(){for(i.width=n.width,i.height=n.height,i.getContext("2d").drawImage(n,0,0,i.width,i.height);i.width>=2*o;)i=s(i);(i.width>o||i.height>e)&&(i=l(i)),a=i.toDataURL("image/jpeg",1),r.resolve(a)},r.promise}}}]),angular.module("BookingSystem.imageUploaderDirective",["BookingSystem.imageResizeServices"]).controller("imageUploaderCtrl",["$scope","$q","$element","$attrs","$rootScope","CustomerImage","ImageResize","API_IMG_PATH_URL","PHOTO_MISSING_SRC",function(o,e,t,n,i,r,a,s,u){o.file="",o.progress=0,o.isProgressVisible=!1;var c=function(e,t){return function(){o.$apply(function(){a.scaleImage(e.result).then(function(e){o.displayImageSrc=e,o.base64EncodedImage=e.replace(/^data:image\/jpeg;base64,/,""),t.resolve()})})}},l=function(e,t){return function(){o.$apply(function(){t.reject(e.result)})}},m=function(o){return function(o){}},d=function(o){var e=!1;return"image/png"!==o.type&&"image/jpg"!==o.type&&"image/jpeg"!==o.type&&"image/gif"!==o.type||o.size<1e7&&(e=!0),e};o.$watch("imageSrc",function(e,t){"undefined"!=typeof e&&""!==e?o.displayImageSrc=s+e+"?"+Date.now():o.displayImageSrc=u}),o.readUploadedFile=function(o){var t=e.defer(),n=new FileReader,r=null;return d(o)?(n.onload=c(n,t),n.onerror=l(n,t),n.onprogress=m(n),n.readAsDataURL(o),r=t.promise):(i.FlashMessage={type:"error",message:"Den uppladdade bilden måste vara av typen: jpg, gif eller png och får inte överstiga 10mb i storlek"},t.reject(),r=t.promise),r}}]).directive("imageUploader",["$http",function(o){return{restrict:"E",link:function(o,e,t){},scope:{imageSrc:"=imageSrc",base64EncodedImage:"=base64EncodedImage"},replace:!0,templateUrl:"templates/directives/image-uploader-directive.html",controller:"imageUploaderCtrl"}}]).directive("imageUploaderFile",function(){return{restrict:"A",replace:!1,scope:!1,controller:["$scope","$element","$attrs",function(o,e,t){e.bind("change",function(e){var t=(e.srcElement||e.target).files[0];o.readUploadedFile(t)})}]}}),angular.module("BookingSystem.filters",[]).filter("zpad",[function(){return function(o,e){if(void 0===o&&(o=""),o.length>=e)return o;var t="0".repeat(e);return(t+o).slice(-1*e)}}]).filter("kr",function(){return function(o){var e=void 0;return"undefined"!=typeof o&&(o=o.toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1 "),e=o+" kr"),e}}).filter("count",function(){return function(o){return o+" st"}}).filter("percentage",["$filter",function(o){return function(e){return o("number")(100*e,0)+"%"}}]),function(){var o=function(o){return angular.isUndefined(o)||""===o||null===o||void 0===o};angular.module("BookingSystem.ngMinMaxDirectives",[]).directive("ngMin",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,i){e.$watch(n.ngMin,function(){i.$setViewValue(i.$viewValue)});var r=function(t){var r=e.$eval(n.ngMin)||0;return!o(t)&&r>t?void i.$setValidity("ngMin",!1):(i.$setValidity("ngMin",!0),t)};i.$parsers.push(r),i.$formatters.push(r)}}}).directive("ngMax",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,i){e.$watch(n.ngMax,function(){i.$setViewValue(i.$viewValue)});var r=function(t){var r=e.$eval(n.ngMax)||1/0;return!o(t)&&t>r?void i.$setValidity("ngMax",!1):(i.$setValidity("ngMax",!0),t)};i.$parsers.push(r),i.$formatters.push(r)}}})}(),angular.module("BookingSystem.bookingServices",["ngResource"]).factory("Booking",["$resource","API_URL",function(o,e){return o(e+"Booking/:bookingId",{bookingId:"@bookingId"},{queryLessForPeriod:{url:e+"Booking/period/:fromDate/:toDate/less",id:"@id",method:"GET",isArray:!0,params:{fromDate:"@fromDate",toDate:"@toDate"}},queryMoreForPeriod:{url:e+"Booking/period/:fromDate/:toDate/more",id:"@id",method:"GET",isArray:!0,params:{fromDate:"@fromDate",toDate:"@toDate"}},countEmpty:{url:e+"Booking/empty/count",id:"@id",method:"GET",isArray:!1},queryEmpty:{url:e+"Booking/empty/info",id:"@id",method:"GET",isArray:!0},querySearch:{url:e+"Booking/search/:column",id:"@id",method:"GET",isArray:!0,params:{column:"@column"}}})}]),angular.module("BookingSystem.bookings",[]).controller("BookingViewCtrl",["$rootScope","$scope","$state","Booking","LocationBooking","ResourceBooking","MealBooking","$interval","DATA_SYNC_INTERVAL_TIME","$ionicGesture","$mdToast","DEFAULT_CALENDAR_ZOOM","$stateParams","$ionicHistory","$ionicModal","MODAL_ANIMATION","BOOKING_TYPES",function(o,e,t,n,i,r,a,s,u,c,l,m,d,g,p,k,f){var h="templates/modals/booking-create-choose-type.html",b=u,y=null,v=null,M=null;e.zoom=m,e.weekDate=moment(),e.bookingTypes=f,e.bookingsType=e.bookingTypes.booking;var B=function(){p.fromTemplateUrl(h,{scope:e,animation:k}).then(function(o){e.modal=o}),e.$on("$destroy",function(){e.modal.remove()})},I=function(){var o=arguments.length<=0||void 0===arguments[0]?0:arguments[0];o>0?e.weekDate=moment(e.weekDate).add(1,"weeks"):0>o&&(e.weekDate=moment(e.weekDate).subtract(1,"weeks")),v=moment(e.weekDate).startOf("week"),M=moment(e.weekDate).endOf("week")},$=function(){switch(e.bookingsType){case e.bookingTypes.booking:e.calendarTitle="Bokningstillfällen";break;case e.bookingTypes.location:e.calendarTitle="Lokalbokningar";break;case e.bookingTypes.resource:e.calendarTitle="Resursbokningar";break;case e.bookingTypes.meal:e.calendarTitle="Måltidsbokningar";break;default:e.calendarTitle="Bokningstillfällen"}},D=function(){var o=void 0;switch(e.bookingsType){case e.bookingTypes.booking:o=n.queryLessForPeriod({fromDate:v.format("YYYY-MM-DD"),toDate:M.format("YYYY-MM-DD")});break;case e.bookingTypes.location:o=i.queryLessForPeriod({fromDate:v.format("YYYY-MM-DD"),toDate:M.format("YYYY-MM-DD")});break;case e.bookingTypes.resource:o=r.queryLessForPeriod({fromDate:v.format("YYYY-MM-DD"),toDate:M.format("YYYY-MM-DD")});break;case e.bookingTypes.meal:o=a.queryLessForPeriod({fromDate:v.format("YYYY-MM-DD"),toDate:M.format("YYYY-MM-DD")});break;default:o={}}o.$promise["catch"](function(){l.show(l.simple().content("Bokningar kunde inte hämtas, var god försök igen.").position("top right"))}).then(function(o){e.bookings=o})},S=function(){y=s(function(){D()},b)},w=function(){var o=angular.element(document.querySelector("#booking-view-content"));c.on("pinch",function(o){
o.gesture.srcEvent.preventDefault(),e.$apply(function(){e.zoom=o.gesture.scale})},o),c.on("swipeleft",function(o){e.toNextWeek(),e.$apply(),e.$broadcast("swipe-occurred")},o),c.on("swiperight",function(o){e.toPreviousWeek(),e.$apply(),e.$broadcast("swipe-occurred")},o)};e.toNextWeek=function(){I(1),D()},e.toPreviousWeek=function(){I(-1),D()},e.changeBookingTypeTo=function(o){e.$broadcast("changed-booking-type",{bookingType:o})},e.createBookingOfType=function(o){t.go("app."+o+"-create"),e.modal.hide()},e.$on("changed-booking-type",function(o,t){e.bookingsType=t.bookingType,D(),$()}),e.$on("$ionicView.enter",function(o,e){I(),D(),S(),$(),B()}),e.$on("$ionicView.loaded",function(o,e){w()}),e.$on("$ionicView.leave",function(o){y&&s.cancel(y),e.$broadcast("leaving-view")})}]).controller("BookingDetailsCtrl",["$rootScope","$scope","$stateParams","MODAL_ANIMATION","$state","$ionicModal","Booking","API_IMG_PATH_URL","$mdToast","Customer","PHOTO_MISSING_SRC","$ionicHistory","BOOKING_TYPES",function(o,e,t,n,i,r,a,s,u,c,l,m,d){var g="templates/modals/booking-delete.html";e.editMode=!1,e.bookingBackup={},e.API_IMG_PATH_URL=s,e.customerImageSrc=l,e.bookingTypes=d;var p=function(){r.fromTemplateUrl(g,{scope:e,animation:n}).then(function(o){e.modal=o}),e.$on("$destroy",function(){e.modal.remove()})},k=function(){var o=c.query();return o.$promise["catch"](function(){u.show(u.simple().content("Kunder kunde inte hämtas, var god försök igen.").position("top right"))}),e.customers=o,o.$promise},f=function(){var o=a.get({bookingId:t.id});return o.$promise["catch"](function(){u.show(u.simple().content("Bokningstillfälle kunde inte hämtas, var god försök igen.").position("top right"))}).then(function(){e.booking.Discount*=100,e.updateCustomerImageSrc()}),e.booking=o,o.$promise};e.updateCustomerImageSrc=function(){var o=e.customers.find(function(o){return o.CustomerId===Number(e.booking.CustomerId)});e.customerImageSrc=null!==o.ImageSrc&&o.ImageSrc.length>1?s+o.ImageSrc:l},e.startEditMode=function(){var o=this;o.isEditMode=!0,o.bookingBackup=angular.copy(o.booking)},e.endEditMode=function(){var o=this;o.isEditMode=!1},e.abortEditMode=function(){var o=this;o.$parent.isEditMode=!1,o.booking=o.bookingBackup},e.saveBooking=function(){var o=this;a.save({BookingTypeId:1,BookingId:t.id,CustomerId:o.booking.CustomerId,NumberOfPeople:o.booking.NumberOfPeople,Notes:o.booking.Notes,Discount:o.booking.Discount/100}).$promise.then(function(e){o.endEditMode(),u.show(u.simple().content("Bokningstillfället sparades med ett lyckat resultat").position("top right")),m.goBack()})["catch"](function(o){400!==o.status&&500!==o.status||u.show(u.simple().content("Ett oväntat fel uppstod när bokningstillfället skulle sparas").position("top right")),404===o.status&&(u.show(u.simple().content("Bokningstillfället existerar inte längre. Hann kanske någon radera den?").position("top right")),m.goBack())})},e.deleteBooking=function(){a["delete"]({bookingId:t.id}).$promise.then(function(o){u.show(u.simple().content("Bokningstillfället raderades med ett lyckat resultat").position("top right")),m.goBack()})["catch"](function(o){400===o.status&&"undefined"!==o.data.Message&&"Foreign key references exists"===o.data.Message?u.show(u.simple().content("Bokningstillfället kan inte raderas eftersom det finns en lokalbokning, resursbokning eller en måltidsbokning som refererar till bokningstillfället").position("top right")):400!==o.status&&500!==o.status||u.show(u.simple().content("Ett oväntat fel uppstod när bokningstillfället skulle tas bort").position("top right")),404===o.status&&u.show(u.simple().content('Bokningstillfället "'+e.booking.Name+'" existerar inte längre. Hann kanske någon radera den?').position("top right")),m.goBack()})},e.createBookingOfType=function(o){i.go("app."+o+"-create",{bookingId:t.id,customerId:e.booking.CustomerId})},e.showBooking=function(o,e){i.go("app."+e+"-details",{id:o})},e.$on("$ionicView.beforeEnter",function(o,e){p(),k().then(function(){f()})})}]).controller("BookingCreateCtrl",["$rootScope","$stateParams","$scope","$state","Booking","$mdToast",function(o,e,t,n,i,r){t.booking={},t.saveBooking=function(){var o=this;i.save({BookingId:0,Name:o.booking.Name}).$promise.then(function(e){r.show(r.simple().content('Bokningstillfället "'+o.booking.Name+'" skapades med ett lyckat resultat').position("top right")),history.back()})["catch"](function(e){409===e.status?r.show(r.simple().content('Det finns redan ett bokningstillfälle som heter "'+o.booking.Name+'". Två bokningstillfällen kan inte heta lika.').position("top right")):r.show(r.simple().content("Ett oväntat fel uppstod när bokningstillfället skulle sparas").position("top right"))})}}]),angular.module("BookingSystem.resourceBooking",["ngMessages"]).controller("ResourceBookingViewCtrl",["$rootScope","$scope","$state","ResourceBooking","$interval","DATA_SYNC_INTERVAL_TIME","$ionicGesture","$mdToast","DEFAULT_CALENDAR_ZOOM",function(o,e,t,n,i,r,a,s,u){var c=r,l=null,m=null,d=null;e.zoom=u,e.weekDate=moment();var g=function(){var o=arguments.length<=0||void 0===arguments[0]?0:arguments[0];o>0?e.weekDate=moment(e.weekDate).add(1,"weeks"):0>o&&(e.weekDate=moment(e.weekDate).subtract(1,"weeks")),m=moment(e.weekDate).startOf("week"),d=moment(e.weekDate).endOf("week")},p=function(){var o=n.queryLessForPeriod({fromDate:m.format("YYYY-MM-DD"),toDate:d.format("YYYY-MM-DD")});o.$promise["catch"](function(){s.show(s.simple().content("Resursbokningar kunde inte hämtas, var god försök igen.").position("top right"))}).then(function(o){e.resourceBookings=o})},k=function(){l=i(function(){p()},c)},f=function(){var o=angular.element(document.querySelector("#booking-view-content"));a.on("pinch",function(o){o.gesture.srcEvent.preventDefault(),e.$apply(function(){e.zoom=o.gesture.scale})},o),a.on("swipeleft",function(o){e.toNextWeek(),e.$apply(),e.$broadcast("swipe-occurred")},o),a.on("swiperight",function(o){e.toPreviousWeek(),e.$apply(),e.$broadcast("swipe-occurred")},o)};e.toNextWeek=function(){g(1),p()},e.toPreviousWeek=function(){g(-1),p()},e.$on("$ionicView.beforeEnter",function(o,e){g(),p(),k()}),e.$on("$ionicView.loaded",function(o,e){f()}),e.$on("$ionicView.leave",function(o){l&&i.cancel(l),e.$broadcast("leaving-view")})}]).controller("ResourceBookingDetailsCtrl",["$rootScope","$scope","$stateParams","MODAL_ANIMATION","$state","$ionicModal","ResourceBooking","$mdToast","Resource","Customer","BookingHelper","$q","$ionicHistory","API_IMG_PATH_URL",function(o,e,t,n,i,r,a,s,u,c,l,m,d,g){var p="templates/modals/resource-booking-delete.html";e.editMode=!1,e.resourceBookingBackup={},e.API_IMG_PATH_URL=g;var k=function(){r.fromTemplateUrl(p,{scope:e,animation:n}).then(function(o){e.modal=o}),e.$on("$destroy",function(){e.modal.remove()})},f=function(){var o=a.get({resourceBookingId:t.id});return o.$promise["catch"](function(){s.show(s.simple().content("Resursbokning kunde inte hämtas, var god försök igen.").position("top right"))}),e.resourceBooking=o,o.$promise},h=function(){var o=e.resourceBooking.StartTime,t=e.resourceBooking.EndTime;e.bookingStartDate=moment(o).toDate(),e.bookingStartHour=moment(o).hour(),e.bookingStartMinute=moment(o).minute(),e.bookingEndDate=moment(t).toDate(),e.bookingEndHour=moment(t).hour(),e.bookingEndMinute=moment(t).minute()},b=function(){return"undefined"!=typeof e.bookingStartDate&&"undefined"!=typeof e.bookingStartHour&&"undefined"!=typeof e.bookingStartMinute&&"undefined"!=typeof e.bookingEndDate&&"undefined"!=typeof e.bookingEndHour&&"undefined"!=typeof e.bookingEndMinute},y=function(){e.selectHours=l.getHoursForSelect(),e.selectMinutes=l.getMinutesForSelect()},v=function(){if(b()){var o=B(e.bookingStartDate,e.bookingStartHour,e.bookingStartMinute),t=B(e.bookingEndDate,e.bookingEndHour,e.bookingEndMinute);u.queryFreeForPeriod({fromDate:o.format("YYYY-MM-DD"),fromTime:o.format("HH:mm"),toDate:t.format("YYYY-MM-DD"),toTime:t.format("HH:mm"),resourceBookingExceptionId:e.resourceBooking.ResourceBookingId}).$promise.then(function(o){e.resources=o,e.setSelectedResourceFromId(e.resourceBooking.ResourceId)})["catch"](function(o){s.show(s.simple().content("Ett oväntat fel uppstod när uppgifter om lediga resurser skulle hämtas").position("top right"))})}},M=function(){var o=c.get({customerId:e.resourceBooking.CustomerId});o.$promise["catch"](function(){s.show(s.simple().content("Kund kunde inte hämtas, var god försök igen.").position("top right"))}),e.customer=o},B=function(o,e,t){return moment(o).hour(e).minute(t)};e.startEditMode=function(){var o=this;o.isEditMode=!0,o.resourceBookingBackup=angular.copy(o.resourceBooking)},e.endEditMode=function(){var o=this;o.isEditMode=!1},e.abortEditMode=function(){var o=this;o.isEditMode=!1,o.resourceBooking=o.resourceBookingBackup},e.deleteResourceBooking=function(){a["delete"]({resourceBookingId:t.id}).$promise.then(function(o){s.show(s.simple().content("Resursbokningen raderades med ett lyckat resultat").position("top right")),history.back()})["catch"](function(o){400!==o.status&&500!==o.status||s.show(s.simple().content("Ett oväntat fel uppstod när Resursbokningen skulle tas bort").position("top right")),404===o.status&&s.show(s.simple().content("Resursbokningen existerar inte längre. Hann kanske någon radera den?").position("top right")),history.back()})},e.checkEndDate=function(){if(b()){var o=B(e.bookingStartDate,e.bookingStartHour,e.bookingStartMinute).toDate().getTime(),t=B(e.bookingEndDate,e.bookingEndHour,e.bookingEndMinute).toDate().getTime();o>t&&(e.bookingEndDate=e.bookingStartDate,e.bookingEndHour=e.bookingStartHour,e.bookingEndMinute=e.bookingStartMinute+15),v()}},e.saveResourceBooking=function(){var o=this,e=m.defer(),t=e.promise;return a.save({BookingId:o.resourceBooking.BookingId,ResourceBookingId:o.resourceBooking.ResourceBookingId,ResourceId:o.resourceBooking.ResourceId,ResourceCount:o.resourceBooking.ResourceCount,StartTime:B(o.bookingStartDate,o.bookingStartHour,o.bookingStartMinute).format(),EndTime:B(o.bookingEndDate,o.bookingEndHour,o.bookingEndMinute).format(),Provisional:o.resourceBooking.Provisional}).$promise.then(function(o){s.show(s.simple().content("Resursbokningen sparades med ett lyckat resultat").position("top right")),e.resolve(),d.goBack()})["catch"](function(o){409===o.status?s.show(s.simple().content("Alla resurser av denna typ är tyvärr redan bokade under vald tidsram.").position("top right")):s.show(s.simple().content("Ett oväntat fel uppstod när resursbokningen skulle sparas").position("top right"))}),t},e.setSelectedResourceFromId=function(o){e.selectedResource=e.resources.find(function(e){return e.ResourceId===Number(o)})},k(),f().then(function(){h(),M(),v()}),y()}]).controller("ResourceBookingCreateCtrl",["$rootScope","$stateParams","$scope","$state","ResourceBooking","Resource","BookingHelper","Customer","$q","$mdToast","$ionicHistory","API_IMG_PATH_URL","PHOTO_MISSING_SRC",function(o,e,t,n,i,r,a,s,u,c,l,m,d){t.resourceBooking={Provisional:!0,BookingTypeId:1},t.API_IMG_PATH_URL=m,t.customerImageSrc=d;var g=function(){n.params.date?(t.bookingStartDate=moment(n.params.date).toDate(),t.bookingStartHour=moment(n.params.date).hour(),t.bookingStartMinute=moment(n.params.date).minute(),t.bookingEndDate=moment(n.params.date).toDate(),t.bookingEndHour=moment(n.params.date).hour(),t.bookingEndMinute=moment(n.params.date).add(59,"minutes").minute()):(t.bookingStartDate=new Date,t.bookingStartHour=8,t.bookingStartMinute=0,t.bookingEndDate=new Date,t.bookingEndHour=8,t.bookingEndMinute=59)},p=function(){return"undefined"!=typeof t.bookingStartDate&&"undefined"!=typeof t.bookingStartHour&&"undefined"!=typeof t.bookingStartMinute&&"undefined"!=typeof t.bookingEndDate&&"undefined"!=typeof t.bookingEndHour&&"undefined"!=typeof t.bookingEndMinute},k=function(){t.selectHours=a.getHoursForSelect(),t.selectMinutes=a.getMinutesForSelect()},f=function(){if(p()){var o=v(t.bookingStartDate,t.bookingStartHour,t.bookingStartMinute),e=v(t.bookingEndDate,t.bookingEndHour,t.bookingEndMinute);r.queryFreeForPeriod({fromDate:o.format("YYYY-MM-DD"),fromTime:o.format("HH:mm"),toDate:e.format("YYYY-MM-DD"),toTime:e.format("HH:mm")}).$promise.then(function(o){t.resources=o})["catch"](function(o){c.show(c.simple().content("Ett oväntat fel uppstod när uppgifter om lediga resurser skulle hämtas").position("top right"))})}},h=function(){var o=s.query();o.$promise["catch"](function(){c.show(c.simple().content("Kunder kunde inte hämtas, var god försök igen.").position("top right"))}),t.customers=o},b=function(){t.customerImageSrc=null!==t.customer.ImageSrc&&t.customer.ImageSrc.length>1?m+t.customer.ImageSrc:d},y=function(){var o=s.get({customerId:n.params.customerId});o.$promise["catch"](function(){c.show(c.simple().content("Kund kunde inte hämtas, var god försök igen.").position("top right"))}).then(function(){b()}),t.customer=o},v=function(o,e,t){return moment(o).hour(e).minute(t)},M=function(){var o=u.defer();return null!==n.params.bookingId?(t.resourceBooking.BookingId=n.params.bookingId,o.resolve()):a.createBookingContainer(t.resourceBooking).then(function(e){t.resourceBooking.BookingId=e.BookingId,o.resolve()})["catch"](function(e){c.show(c.simple().content("Ett oväntat fel uppstod när bokningstillfället skulle sparas").position("top right")),o.reject()}),o.promise};t.checkEndDate=function(){if(p()){var o=v(t.bookingStartDate,t.bookingStartHour,t.bookingStartMinute).toDate().getTime(),e=v(t.bookingEndDate,t.bookingEndHour,t.bookingEndMinute).toDate().getTime();o>e&&(t.bookingEndDate=t.bookingStartDate,t.bookingEndHour=t.bookingStartHour,t.bookingEndMinute=t.bookingStartMinute+15),f()}},t.saveResourceBooking=function(){var o=this,e=u.defer(),t=e.promise;return M().then(function(){i.save({BookingId:o.resourceBooking.BookingId,ResourceBookingId:0,ResourceId:o.resourceBooking.Resource.ResourceId,ResourceCount:o.resourceBooking.ResourceCount,StartTime:v(o.bookingStartDate,o.bookingStartHour,o.bookingStartMinute).format(),EndTime:v(o.bookingEndDate,o.bookingEndHour,o.bookingEndMinute).format(),Provisional:o.resourceBooking.Provisional}).$promise.then(function(o){c.show(c.simple().content(" Resursbokningen skapades med ett lyckat resultat").position("top right")),e.resolve(),l.goBack()})["catch"](function(o){409===o.status?c.show(c.simple().content("Resursen är tyvärr redan bokad under vald tidsram.").position("top right")):c.show(c.simple().content("Ett oväntat fel uppstod när resursbokningen skulle sparas").position("top right"))})}),t},g(),f(),n.params.customerId?y():h(),k()}]),angular.module("BookingSystem.resourceBookingServices",["ngResource"]).factory("ResourceBooking",["$resource","API_URL",function(o,e){return o(e+"ResourceBooking/:resourceBookingId",{resourceBookingId:"@resourceBookingId"},{queryLessForPeriod:{url:e+"ResourceBooking/period/:fromDate/:toDate/less",id:"@id",method:"GET",isArray:!0,params:{fromDate:"@fromDate",toDate:"@toDate"}},queryMoreForPeriod:{url:e+"ResourceBooking/period/:fromDate/:toDate/more",id:"@id",method:"GET",isArray:!0,params:{fromDate:"@fromDate",toDate:"@toDate"}}})}]),angular.module("BookingSystem.calendarDaysHeaderDirective",[]).controller("CalendarDaysHeaderCtrl",["$rootScope","$scope",function(o,e){e.days=[];var t=function(){e.weekDateStart=moment(e.date).startOf("isoWeek");for(var o=0,t=moment(e.weekDateStart);7>o;t.add(1,"days"))e.days[o]={},e.days[o].isCurrentDay=moment().format("YYYY-MM-DD")===t.format("YYYY-MM-DD"),e.days[o].dayNumber=t.format("D"),e.days[o].dayName=t.format("ddd"),o++};e.$watch("date",function(o,e){t()})}]).directive("calendarDaysHeader",[function(){return{restrict:"E",replace:!0,templateUrl:function(o,e){return"templates/directives/calendar-days-header.html"},scope:{date:"="},controller:"CalendarDaysHeaderCtrl"}}]),angular.module("BookingSystem.start",["ngMessages"]).controller("StartViewCtrl",["$rootScope","$scope","$state","Booking","LocationBooking","ResourceBooking","MealBooking","$interval","DATA_SYNC_INTERVAL_TIME","$ionicGesture","$mdToast","DEFAULT_CALENDAR_ZOOM","$stateParams","$ionicHistory","$ionicModal","MODAL_ANIMATION","BOOKING_TYPES",function(o,e,t,n,i,r,a,s,u,c,l,m,d,g,p,k,f){}]),angular.module("BookingSystem.mealBookingServices",["ngResource"]).factory("MealBooking",["$resource","API_URL",function(o,e){return o(e+"MealBooking/:mealBookingId",{mealBookingId:"@mealBookingId"},{queryLessForPeriod:{url:e+"MealBooking/period/:fromDate/:toDate/less",id:"@id",method:"GET",isArray:!0,params:{fromDate:"@fromDate",toDate:"@toDate"}},queryMoreForPeriod:{url:e+"MealBooking/period/:fromDate/:toDate/more",id:"@id",method:"GET",isArray:!0,params:{fromDate:"@fromDate",toDate:"@toDate"}}})}]),angular.module("BookingSystem.mealBooking",["ngMessages"]).controller("MealBookingViewCtrl",["$rootScope","$scope","$state","MealBooking","$interval","DATA_SYNC_INTERVAL_TIME","$ionicGesture","$mdToast","DEFAULT_CALENDAR_ZOOM",function(o,e,t,n,i,r,a,s,u){var c=r,l=null,m=null,d=null;e.zoom=u,e.weekDate=moment();var g=function(){var o=arguments.length<=0||void 0===arguments[0]?0:arguments[0];o>0?e.weekDate=moment(e.weekDate).add(1,"weeks"):0>o&&(e.weekDate=moment(e.weekDate).subtract(1,"weeks")),m=moment(e.weekDate).startOf("week"),d=moment(e.weekDate).endOf("week")},p=function(){var o=n.queryLessForPeriod({fromDate:m.format("YYYY-MM-DD"),toDate:d.format("YYYY-MM-DD")});o.$promise["catch"](function(){s.show(s.simple().content("Måltidsbokningar kunde inte hämtas, var god försök igen.").position("top right"))}).then(function(o){e.mealBookings=o})},k=function(){l=i(function(){p()},c)},f=function(){var o=angular.element(document.querySelector("#booking-view-content"));a.on("pinch",function(o){o.gesture.srcEvent.preventDefault(),e.$apply(function(){e.zoom=o.gesture.scale})},o),a.on("swipeleft",function(o){e.toNextWeek(),e.$apply(),e.$broadcast("swipe-occurred")},o),a.on("swiperight",function(o){e.toPreviousWeek(),e.$apply(),e.$broadcast("swipe-occurred")},o)};e.toNextWeek=function(){g(1),p()},e.toPreviousWeek=function(){g(-1),p()},e.$on("$ionicView.beforeEnter",function(o,e){g(),p(),k()}),e.$on("$ionicView.loaded",function(o,e){f()}),e.$on("$ionicView.leave",function(o){l&&i.cancel(l),e.$broadcast("leaving-view")})}]).controller("MealBookingDetailsCtrl",["$rootScope","$scope","$stateParams","MODAL_ANIMATION","$state","$ionicModal","MealBooking","$mdToast","Meal","Customer","BookingHelper","$q","$ionicHistory","Location","API_IMG_PATH_URL",function(o,e,t,n,i,r,a,s,u,c,l,m,d,g,p){var k="templates/modals/meal-booking-delete.html";e.editMode=!1,e.mealBookingBackup={},e.API_IMG_PATH_URL=p;var f=function(){r.fromTemplateUrl(k,{scope:e,animation:n}).then(function(o){e.modal=o}),e.$on("$destroy",function(){e.modal.remove()})},h=function(){var o=a.get({mealBookingId:t.id});return o.$promise["catch"](function(){s.show(s.simple().content("Måltidsbokning kunde inte hämtas, var god försök igen.").position("top right"))}),e.mealBooking=o,o.$promise},b=function(){var o=e.mealBooking.StartTime,t=e.mealBooking.EndTime;e.bookingStartDate=moment(o).toDate(),e.bookingStartHour=moment(o).hour(),e.bookingStartMinute=moment(o).minute(),e.bookingEndDate=moment(t).toDate(),e.bookingEndHour=moment(t).hour(),e.bookingEndMinute=moment(t).minute()},y=function(){return"undefined"!=typeof e.bookingStartDate&&"undefined"!=typeof e.bookingStartHour&&"undefined"!=typeof e.bookingStartMinute&&"undefined"!=typeof e.bookingEndDate&&"undefined"!=typeof e.bookingEndHour&&"undefined"!=typeof e.bookingEndMinute},v=function(){e.selectHours=l.getHoursForSelect(),e.selectMinutes=l.getMinutesForSelect()},M=function(){g.query().$promise.then(function(o){e.locations=o})["catch"](function(o){s.show(s.simple().content("Ett oväntat fel uppstod när lokaler skulle hämtas").position("top right"))})},B=function(){return e.meals=u.query(),u.query().$promise.then(function(o){e.meals=o})["catch"](function(o){s.show(s.simple().content("Ett oväntat fel uppstod när uppgifter om måltider skulle hämtas").position("top right"))}),u.query().$promise},I=function(){var o=c.get({customerId:e.mealBooking.CustomerId});o.$promise["catch"](function(){s.show(s.simple().content("Kund kunde inte hämtas, var god försök igen.").position("top right"))}),e.customer=o},$=function(o,e,t){return moment(o).hour(e).minute(t)};e.startEditMode=function(){var o=this;o.isEditMode=!0,o.mealBookingBackup=angular.copy(o.mealBooking)},e.endEditMode=function(){var o=this;o.isEditMode=!1},e.abortEditMode=function(){var o=this;o.isEditMode=!1,o.mealBooking=o.mealBookingBackup},e.deleteMealBooking=function(){a["delete"]({mealBookingId:t.id}).$promise.then(function(o){s.show(s.simple().content("Måltidsbokningen raderades med ett lyckat resultat").position("top right")),history.back()})["catch"](function(o){400!==o.status&&500!==o.status||s.show(s.simple().content("Ett oväntat fel uppstod när Måltidsbokningen skulle tas bort").position("top right")),404===o.status&&s.show(s.simple().content("Måltidsbokningen existerar inte längre. Hann kanske någon radera den?").position("top right")),history.back()})},e.checkEndDate=function(){if(y()){var o=$(e.bookingStartDate,e.bookingStartHour,e.bookingStartMinute).toDate().getTime(),t=$(e.bookingEndDate,e.bookingEndHour,e.bookingEndMinute).toDate().getTime();o>t&&(e.bookingEndDate=e.bookingStartDate,e.bookingEndHour=e.bookingStartHour,e.bookingEndMinute=e.bookingStartMinute+15),B()}},e.saveMealBooking=function(){var o=this,e=m.defer(),t=e.promise;return a.save({BookingId:o.mealBooking.BookingId,MealBookingId:o.mealBooking.MealBookingId,MealId:o.mealBooking.MealId,StartTime:$(o.bookingStartDate,o.bookingStartHour,o.bookingStartMinute).format(),EndTime:$(o.bookingEndDate,o.bookingEndHour,o.bookingEndMinute).format(),NumberOfPeople:o.mealBooking.NumberOfPeople,Provisional:o.mealBooking.Provisional,LocationId:o.mealBooking.LocationId,DeliveryAddress:o.mealBooking.DeliveryAddress,MealCount:o.mealBooking.MealCount,Notes:o.mealBooking.Notes}).$promise.then(function(o){s.show(s.simple().content("Måltidsbokningen sparades med ett lyckat resultat").position("top right")),e.resolve(),d.goBack()})["catch"](function(o){s.show(s.simple().content("Ett oväntat fel uppstod när måltidsbokningen skulle sparas").position("top right"))}),t},f(),h().then(function(){return b(),B()}).then(function(){return I()}).then(function(){M(),v()})}]).controller("MealBookingCreateCtrl",["$rootScope","$stateParams","$scope","$state","MealBooking","Meal","BookingHelper","Customer","$q","$mdToast","$ionicHistory","Location","API_IMG_PATH_URL","PHOTO_MISSING_SRC",function(o,e,t,n,i,r,a,s,u,c,l,m,d,g){t.mealBooking={Provisional:!0,BookingTypeId:1},t.API_IMG_PATH_URL=d,t.customerImageSrc=g;var p=function(){n.params.date?(t.bookingStartDate=moment(n.params.date).toDate(),t.bookingStartHour=moment(n.params.date).hour(),t.bookingStartMinute=moment(n.params.date).minute(),t.bookingEndDate=moment(n.params.date).toDate(),t.bookingEndHour=moment(n.params.date).hour(),t.bookingEndMinute=moment(n.params.date).add(59,"minutes").minute()):(t.bookingStartDate=new Date,t.bookingStartHour=8,t.bookingStartMinute=0,t.bookingEndDate=new Date,t.bookingEndHour=8,t.bookingEndMinute=59)},k=function(){return"undefined"!=typeof t.bookingStartDate&&"undefined"!=typeof t.bookingStartHour&&"undefined"!=typeof t.bookingStartMinute&&"undefined"!=typeof t.bookingEndDate&&"undefined"!=typeof t.bookingEndHour&&"undefined"!=typeof t.bookingEndMinute},f=function(){t.selectHours=a.getHoursForSelect(),t.selectMinutes=a.getMinutesForSelect()},h=function(){var o=m.query();return o.$promise.then(function(o){t.locations=o})["catch"](function(o){c.show(c.simple().content("Ett oväntat fel uppstod när lokaler skulle hämtas").position("top right"))}),o.$promise},b=function(){return t.meals=r.query(),t.meals.$promise.then(function(o){t.meals=o})["catch"](function(o){c.show(c.simple().content("Ett oväntat fel uppstod när uppgifter om måltider skulle hämtas").position("top right"))}),t.meals.$promise},y=function(){var o=s.query();return o.$promise["catch"](function(){c.show(c.simple().content("Kunder kunde inte hämtas, var god försök igen.").position("top right"))}),t.customers=o,o.$promise},v=function(){t.customerImageSrc=null!==t.customer.ImageSrc&&t.customer.ImageSrc.length>1?d+t.customer.ImageSrc:g},M=function(){var o=s.get({customerId:n.params.customerId});return o.$promise["catch"](function(){c.show(c.simple().content("Kund kunde inte hämtas, var god försök igen.").position("top right"))}).then(function(){v()}),t.customer=o,o.$promise},B=function(o,e,t){return moment(o).hour(e).minute(t)},I=function(){var o=u.defer();return null!==n.params.bookingId?(t.mealBooking.BookingId=n.params.bookingId,o.resolve()):a.createBookingContainer(t.mealBooking).then(function(e){t.mealBooking.BookingId=e.BookingId,o.resolve()})["catch"](function(e){c.show(c.simple().content("Ett oväntat fel uppstod när bokningstillfället skulle sparas").position("top right")),o.reject()}),o.promise};t.checkEndDate=function(){if(k()){var o=B(t.bookingStartDate,t.bookingStartHour,t.bookingStartMinute).toDate().getTime(),e=B(t.bookingEndDate,t.bookingEndHour,t.bookingEndMinute).toDate().getTime();o>e&&(t.bookingEndDate=t.bookingStartDate,t.bookingEndHour=t.bookingStartHour,t.bookingEndMinute=t.bookingStartMinute+15),b()}},t.saveMealBooking=function(){var o=this,e=u.defer(),t=e.promise;return I().then(function(){i.save({BookingId:o.mealBooking.BookingId,MealBookingId:0,MealId:o.mealBooking.MealId,StartTime:B(o.bookingStartDate,o.bookingStartHour,o.bookingStartMinute).format(),EndTime:B(o.bookingEndDate,o.bookingEndHour,o.bookingEndMinute).format(),LocationId:o.mealBooking.LocationId,DeliveryAddress:o.mealBooking.DeliveryAddress,MealCount:o.mealBooking.MealCount,Provisional:o.mealBooking.Provisional,Notes:o.mealBooking.Notes}).$promise.then(function(o){c.show(c.simple().content("Måltidsbokningen skapades med ett lyckat resultat").position("top right")),e.resolve(),l.goBack()})["catch"](function(o){c.show(c.simple().content("Ett oväntat fel uppstod när måltidsbokningen skulle sparas").position("top right"))})}),t},p(),b().then(function(){return n.params.customerId?M():y()}).then(function(){h(),f()})}]);